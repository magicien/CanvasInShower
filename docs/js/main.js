!function(){"use strict";var e=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e){return e},r=t-e;return e+n(Math.random())*r},t=function(t){return e()<=t},n=function(e){return e<.5?2*e*e:1-Math.pow(-2*e+2,2)/2},r=function(e){if(e<=0)return 0;if(e>=1)return 1;var t=2*Math.PI/3;return Math.pow(2,-10*e)*Math.sin((10*e-.75)*t)+1},i=function(e,t,n,r){var i=Date.now()+1e3*t;setTimeout((function t(){var o=Math.min(e,.001*(Date.now()-i));n(o),o<e?requestAnimationFrame(t):r&&r()}),1e3*t)},o=function(e,t){var n=document.getElementById(e);if(n){var r=function(e){e.preventDefault(),t(e)};n.addEventListener("touchstart",r),n.addEventListener("mousedown",r)}},a=function(e){var t=document.getElementById(e);if(t){var n=function(e){e.stopPropagation()};t.addEventListener("touchstart",n),t.addEventListener("mousedown",n)}},s=function(){var e;(e=console).error.apply(e,arguments)},u=[],c={},l=!1,f=function(){for(var e=0;e<26;e+=1)u.push(String.fromCharCode(65+e));for(var t=0;t<26;t+=1)u.push(String.fromCharCode(97+t));for(var n=0;n<10;n+=1)u.push(String.fromCharCode(48+n));u.push("-"),u.push("/");for(var r=0;r<64;r+=1)c[u[r]]=r;l=!0},h=function(e){return l||f(),e<0||e>=64?null:u[e]},d=function(e){return l||f(),c[e]};function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var m=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=t,this.icon=n,this.onClick=r,this.moveY=135}var t,o;return t=e,(o=[{key:"appendTo",value:function(e){var t=this,n="\n      <li id='".concat(this.id,"-container' class='menu-item'>\n        <button id='").concat(this.id,"' class='menu-item-button'>\n          <i id='").concat(this.id,"-icon' class='menu-item-icon fa-solid fa-").concat(this.icon,"'></i>\n        </button>\n        <div id='").concat(this.id,"-bounce' class='menu-item-bounce'></div>\n      </li>\n    ");e.insertAdjacentHTML("beforeend",n),this.element=document.getElementById(this.id),this.element.addEventListener("touchstart",(function(e){return t.handleClick(e)})),this.element.addEventListener("mousedown",(function(e){return t.handleClick(e)})),this.element.style.top="0",this.element.style.right="0",this.iconElement=document.getElementById("".concat(this.id,"-icon")),this.bounce=document.getElementById("".concat(this.id,"-bounce")),this.container=document.getElementById("".concat(this.id,"-container"))}},{key:"setIcon",value:function(e){var t=this;this.iconElement.classList.replace("fa-".concat(this.icon),"fa-".concat(e)),this.element.style.right=1,setTimeout((function(){t.element.style.right=0}),10),this.icon=e}},{key:"handleClick",value:function(e){e.preventDefault(),this.onClick&&this.onClick(e)}},{key:"open",value:function(e){var t=this,o=parseInt(this.element.style.top,10)||0,a=this.moveY-o;i(.5,e,(function(e){var n=Math.min(e/.5,1),r=o+a*function(e){var t=2*e;return t<1?.5*Math.pow(t,5):(t-=2,.5*(Math.pow(t,5)+2))}(n);t.element.style.top="".concat(r,"px")}),(function(){t.element.style.top="".concat(t.moveY+1,"px")})),i(3.35,e,(function(e){if(e<.2){var i=n(e/.2),o=1-.2*i,a=1+.2*i;t.bounce.style.transform="scale(".concat(o,", ").concat(a,")")}else if(e<.35){var s=1.2-.5*n((e-.2)/.15);t.bounce.style.transform="scale(0.8, ".concat(s,")")}else{var u=Math.min(1,(e-.35)/3),c=.5+.3*r(u);t.bounce.style.transform="scale(0.8, ".concat(c,")")}}))}},{key:"close",value:function(e){var t=this,o=parseInt(this.element.style.top,10)||0,a=-o;i(.3,e,(function(e){var n=Math.min(e/.3,1),r=o+a*function(e){return Math.pow(e,5)}(n);t.element.style.top="".concat(r,"px")})),i(3.35,e,(function(e){if(e<.2){var i=.8+.2*n(e/.2);t.bounce.style.transform="scale(".concat(i,", 0.8)")}else if(e<.35){var o=.8+.4*n((e-.2)/.15);t.bounce.style.transform="scale(1.0, ".concat(o,")")}else{var a=Math.min(1,(e-.35)/3),s=1.2-.2*r(a);t.bounce.style.transform="scale(1.0, ".concat(s,")")}}))}}])&&p(t.prototype,o),Object.defineProperty(t,"prototype",{writable:!1}),e}();function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var g=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.position=[0,0],this.scale=[1,1],this.rotation=0,this.localMatrix=[1,0,0,0,1,0,0,0,1],this.worldMatrix=[1,0,0,0,1,0,0,0,1],this.parent=null}var t,n;return t=e,(n=[{key:"update",value:function(){this.updateLocalMatrix(),this.updateWorldMatrix()}},{key:"updateLocalMatrix",value:function(){var e=Math.sin(this.rotation),t=Math.cos(this.rotation),n=this.scale[0],r=this.scale[1];this.localMatrix=[t*n,-e*n,0,e*r,t*r,0,this.position[0],this.position[1],1]}},{key:"updateWorldMatrix",value:function(){if(this.parent){var e=this.parent.worldMatrix,t=this.localMatrix;this.worldMatrix=[t[0]*e[0]+t[1]*e[3]+t[2]*e[6],t[0]*e[1]+t[1]*e[4]+t[2]*e[7],t[0]*e[2]+t[1]*e[5]+t[2]*e[8],t[3]*e[0]+t[4]*e[3]+t[5]*e[6],t[3]*e[1]+t[4]*e[4]+t[5]*e[7],t[3]*e[2]+t[4]*e[5]+t[5]*e[8],t[6]*e[0]+t[7]*e[3]+t[8]*e[6],t[6]*e[1]+t[7]*e[4]+t[8]*e[7],t[6]*e[2]+t[7]*e[5]+t[8]*e[8]]}else this.worldMatrix=function(e){if(Array.isArray(e))return v(e)}(n=this.localMatrix)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(n)||function(e,t){if(e){if("string"==typeof e)return v(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?v(e,t):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}();var n}},{key:"getWorldPosition",value:function(){return[this.worldMatrix[6],this.worldMatrix[7]]}}])&&y(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function b(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);a=!0);}catch(e){s=!0,i=e}finally{try{a||null==n.return||n.return()}finally{if(s)throw i}}return o}}(e,t)||function(e,t){if(e){if("string"==typeof e)return w(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?w(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function w(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var x=2048,P={getPosition:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=P[e],i=r.root,o=r[t],a=n?-1:1;return[(o[0]-i[0])*a,(o[1]-i[1])*a]},getTexcoord:function(e){var t,n,r,i,o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=b(P[e].texcoord,4),u=s[0],c=s[1],l=s[2],f=s[3];return o?(t=l,r=u):(t=u,r=l),a?(n=f,i=c):(n=c,i=f),[t,n,r,n,r,i,t,i]},getVertexPosition:function(e){var t,n,r,i,o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],u=P[e],c=b(u.texcoord,4),l=c[0],f=c[1],h=c[2],d=c[3],p=u.root;o?(t=h,r=l):(t=l,r=h),t=t*x-p[0],r=r*x-p[0],a?(n=d,i=f):(n=f,i=d);var m=s?-1:1;return[t,n=(n*x-p[1])*m,r,n,r,i=(i*x-p[1])*m,t,i]},root:{root:[0,0],body:[-550,580]},body:{root:[256,1024],upperArm:[411,312],head:[230,-50],texcoord:[0,0,.25,.5]},upperArm:{root:[243,1186],lowerArm:[243,1869],texcoord:[0,.5,.25,1]},lowerArm:{root:[775,1839],hand:[755,1373],texcoord:[.25,.5,.5,1]},hand:{root:[1300,1479],finger:[1216,1080],texcoord:[.5,.5,.75,.75],texcoords:[[.5,.5,.75,.75],[.75,.5,1,.75],[.5,.75,.75,1],[.75,.75,1,1]]},head:{root:[1840,850],mouth:[1962,895],hair1:[2110,610],hair2:[2020,660],texcoord:[.75,.25,1,.5]},mouth:{root:[1664,128],texcoord:[.75,0,.875,.125],texcoords:[[.75,0,.875,.125],[.875,0,1,.125],[.75,.125,.875,.25],[.875,.125,1,.25]]},hair1:{root:[1080,560],texcoord:[.5,.25,.625,.5]},hair2:{root:[1372,560],texcoord:[.625,.25,.75,.5]}},S=P,A=[[[46.54545454545454,134.16042780748668],[46.54545454545454,134.16042780748668],[46.54545454545454,136.89839572192517],[45.17647058823529,141.00534759358294],[45.17647058823529,143.74331550802142],[43.80748663101604,146.48128342245994],[43.80748663101604,149.21925133689845],[42.43850267379679,153.3262032085562],[41.06951871657754,157.43315508021396],[39.700534759358284,161.5401069518717],[38.331550802139034,165.64705882352945],[36.962566844919785,171.12299465240648],[35.593582887700535,175.22994652406422],[35.593582887700535,177.96791443850273],[34.22459893048128,179.33689839572196],[34.22459893048128,179.33689839572196],[34.22459893048128,180.70588235294122],[34.22459893048128,182.07486631016047],[34.22459893048128,183.44385026737973],[34.22459893048128,184.812834224599],[35.593582887700535,186.18181818181822],[35.593582887700535,186.18181818181822],[36.962566844919785,187.55080213903747],[38.331550802139034,188.91978609625673],[39.700534759358284,190.288770053476],[42.43850267379679,190.288770053476],[45.17647058823529,191.65775401069524],[46.54545454545454,191.65775401069524],[47.9144385026738,191.65775401069524],[49.283422459893046,191.65775401069524],[50.652406417112296,191.65775401069524],[50.652406417112296,191.65775401069524],[52.021390374331546,190.288770053476],[53.3903743315508,188.91978609625673],[53.3903743315508,187.55080213903747],[54.75935828877005,184.812834224599],[56.1283422459893,183.44385026737973],[56.1283422459893,182.07486631016047],[56.1283422459893,180.70588235294122],[56.1283422459893,180.70588235294122],[56.1283422459893,179.33689839572196],[56.1283422459893,179.33689839572196],[57.49732620320855,176.59893048128347],[57.49732620320855,173.86096256684496],[57.49732620320855,171.12299465240648],[57.49732620320855,169.75401069518722],[57.49732620320855,168.38502673796796],[57.49732620320855,167.0160427807487],[57.49732620320855,165.64705882352945],[57.49732620320855,162.90909090909096],[56.1283422459893,160.17112299465245],[56.1283422459893,156.0641711229947],[54.75935828877005,151.95721925133694],[53.3903743315508,149.21925133689845],[53.3903743315508,146.48128342245994],[52.021390374331546,143.74331550802142],[52.021390374331546,142.3743315508022],[52.021390374331546,142.3743315508022],[52.021390374331546,141.00534759358294],[50.652406417112296,138.26737967914443],[50.652406417112296,135.52941176470594],[49.283422459893046,132.79144385026743],[49.283422459893046,131.42245989304817],[49.283422459893046,130.0534759358289],[49.283422459893046,128.68449197860969],[49.283422459893046,128.68449197860969],null,[147.85026737967914,38.33155080213909],[147.85026737967914,38.33155080213909],[146.48128342245988,41.0695187165776],[143.74331550802137,46.5454545454546],[141.00534759358288,53.39037433155086],[139.63636363636363,58.86631016042786],[136.8983957219251,62.973262032085614],[134.16042780748663,67.08021390374337],[132.79144385026737,71.18716577540113],[131.4224598930481,72.55614973262037],[130.05347593582886,75.29411764705888],[128.68449197860963,78.03208556149738],[128.68449197860963,80.77005347593588],[128.68449197860963,82.13903743315514],[128.68449197860963,84.87700534759364],[128.68449197860963,87.61497326203214],[128.68449197860963,88.9839572192514],[128.68449197860963,91.7219251336899],[130.05347593582886,94.4598930481284],[131.4224598930481,97.19786096256689],[132.79144385026737,99.93582887700539],[135.52941176470588,102.6737967914439],[136.8983957219251,104.04278074866315],[138.26737967914437,104.04278074866315],[141.00534759358288,104.04278074866315],[143.74331550802137,104.04278074866315],[146.48128342245988,104.04278074866315],[147.85026737967914,102.6737967914439],[149.2192513368984,101.30481283422465],[153.32620320855614,95.82887700534765],[153.32620320855614,94.4598930481284],[153.32620320855614,90.35294117647064],[153.32620320855614,86.24598930481288],[153.32620320855614,82.13903743315514],[153.32620320855614,78.03208556149738],[153.32620320855614,73.92513368983963],[153.32620320855614,69.81818181818187],[153.32620320855614,65.71122994652411],[153.32620320855614,62.973262032085614],[153.32620320855614,61.604278074866365],[153.32620320855614,60.235294117647115],[153.32620320855614,58.86631016042786],[151.95721925133688,56.12834224598936],[151.95721925133688,54.75935828877011],[150.58823529411765,52.0213903743316],[150.58823529411765,50.65240641711235],[150.58823529411765,50.65240641711235],[149.2192513368984,50.65240641711235],[149.2192513368984,50.65240641711235],[149.2192513368984,50.65240641711235],[149.2192513368984,49.2834224598931],[149.2192513368984,49.2834224598931],[149.2192513368984,49.2834224598931],[149.2192513368984,47.91443850267385],[149.2192513368984,46.5454545454546],[149.2192513368984,45.17647058823535],[149.2192513368984,42.43850267379685],[149.2192513368984,41.0695187165776],[149.2192513368984,41.0695187165776],[149.2192513368984,39.70053475935834],[149.2192513368984,39.70053475935834],[147.85026737967914,39.70053475935834],null],[[156.06417112299465,36.96256684491984],[156.06417112299465,36.96256684491984],[154.6951871657754,38.33155080213909],[151.95721925133688,41.0695187165776],[150.58823529411765,43.8074866310161],[149.2192513368984,46.5454545454546],[147.85026737967914,46.5454545454546],[147.85026737967914,47.91443850267385],[147.85026737967914,47.91443850267385],[146.48128342245988,49.2834224598931],[145.11229946524062,50.65240641711235],[143.74331550802137,52.0213903743316],[143.74331550802137,53.39037433155086],[142.37433155080214,54.75935828877011],[142.37433155080214,56.12834224598936],[142.37433155080214,56.12834224598936],[141.00534759358288,56.12834224598936],[141.00534759358288,56.12834224598936],[141.00534759358288,56.12834224598936],[141.00534759358288,56.12834224598936],[138.26737967914437,53.39037433155086],[132.79144385026737,50.65240641711235],[127.31550802139037,47.91443850267385],[120.47058823529412,46.5454545454546],[114.9946524064171,45.17647058823535],[110.88770053475935,45.17647058823535],[106.7807486631016,45.17647058823535],[101.30481283422459,45.17647058823535],[94.45989304812834,45.17647058823535],[87.61497326203208,45.17647058823535],[80.77005347593582,46.5454545454546],[75.29411764705883,46.5454545454546],[72.55614973262031,46.5454545454546],[69.81818181818181,47.91443850267385],[68.44919786096256,47.91443850267385],[65.71122994652406,49.2834224598931],[64.34224598930481,50.65240641711235],[62.97326203208556,52.0213903743316],[61.60427807486631,53.39037433155086],[60.23529411764706,54.75935828877011],[58.8663101604278,54.75935828877011],[56.1283422459893,56.12834224598936],[53.3903743315508,57.49732620320861],[50.652406417112296,57.49732620320861],[49.283422459893046,58.86631016042786],[47.9144385026738,58.86631016042786],[47.9144385026738,60.235294117647115],[47.9144385026738,60.235294117647115],[47.9144385026738,60.235294117647115],[47.9144385026738,60.235294117647115],[47.9144385026738,60.235294117647115],[47.9144385026738,60.235294117647115],[49.283422459893046,58.86631016042786],[49.283422459893046,58.86631016042786],[50.652406417112296,58.86631016042786],[52.021390374331546,60.235294117647115],[54.75935828877005,60.235294117647115],[57.49732620320855,62.973262032085614],[60.23529411764706,64.34224598930487],[62.97326203208556,67.08021390374337],[65.71122994652406,69.81818181818187],[67.08021390374331,72.55614973262037],[67.08021390374331,73.92513368983963],[68.44919786096256,75.29411764705888],[68.44919786096256,78.03208556149738],[69.81818181818181,80.77005347593588],[69.81818181818181,84.87700534759364],[69.81818181818181,88.9839572192514],[69.81818181818181,93.09090909090914],[69.81818181818181,97.19786096256689],[68.44919786096256,99.93582887700539],[68.44919786096256,101.30481283422465],[68.44919786096256,102.6737967914439],[67.08021390374331,104.04278074866315],[68.44919786096256,104.04278074866315],[68.44919786096256,102.6737967914439],[69.81818181818181,102.6737967914439],[71.18716577540107,102.6737967914439],[72.55614973262031,101.30481283422465],[75.29411764705883,101.30481283422465],[78.03208556149733,101.30481283422465],[82.13903743315508,101.30481283422465],[86.24598930481282,101.30481283422465],[87.61497326203208,102.6737967914439],[90.35294117647058,102.6737967914439],[90.35294117647058,102.6737967914439],[93.09090909090908,104.04278074866315],[97.19786096256684,106.78074866310166],[102.67379679144385,112.25668449197866],[108.14973262032085,117.73262032085566],[112.2566844919786,121.83957219251342],[114.9946524064171,124.57754010695191],[116.36363636363636,125.94652406417117],[116.36363636363636,125.94652406417117],[116.36363636363636,128.68449197860969],[117.7326203208556,132.79144385026743],[119.10160427807486,136.89839572192517],[119.10160427807486,141.00534759358294],[120.47058823529412,142.3743315508022],[120.47058823529412,143.74331550802142],[120.47058823529412,145.11229946524068],[120.47058823529412,145.11229946524068],[120.47058823529412,145.11229946524068],[120.47058823529412,145.11229946524068],[120.47058823529412,145.11229946524068],[121.83957219251336,143.74331550802142],[121.83957219251336,143.74331550802142],[121.83957219251336,142.3743315508022],[123.20855614973262,141.00534759358294],[125.94652406417111,139.63636363636368],[128.68449197860963,138.26737967914443],[131.4224598930481,136.89839572192517],[134.16042780748663,135.52941176470594],[136.8983957219251,135.52941176470594],[138.26737967914437,135.52941176470594],[139.63636363636363,135.52941176470594],[141.00534759358288,135.52941176470594],[143.74331550802137,136.89839572192517],[145.11229946524062,138.26737967914443],[147.85026737967914,141.00534759358294],[149.2192513368984,141.00534759358294],[149.2192513368984,142.3743315508022],[150.58823529411765,145.11229946524068],[151.95721925133688,150.5882352941177],[154.6951871657754,156.0641711229947],[157.4331550802139,161.5401069518717],[158.80213903743314,165.64705882352945],[160.1711229946524,168.38502673796796],[160.1711229946524,168.38502673796796],[160.1711229946524,168.38502673796796],[160.1711229946524,168.38502673796796],[160.1711229946524,167.0160427807487],[161.54010695187165,164.27807486631022],[162.9090909090909,161.5401069518717],[165.6470588235294,154.69518716577545],[168.3850267379679,145.11229946524068],[171.12299465240642,136.89839572192517],[172.49197860962565,130.0534759358289],[173.8609625668449,124.57754010695191],[173.8609625668449,121.83957219251342],[175.22994652406416,119.10160427807492],[175.22994652406416,116.36363636363642],[175.22994652406416,112.25668449197866],[175.22994652406416,105.4117647058824],[175.22994652406416,99.93582887700539],[173.8609625668449,94.4598930481284],[173.8609625668449,91.7219251336899],[172.49197860962565,88.9839572192514],[169.75401069518716,83.50802139037438],[167.01604278074865,78.03208556149738],[162.9090909090909,72.55614973262037],[160.1711229946524,68.44919786096261],[156.06417112299465,64.34224598930487],[154.6951871657754,62.973262032085614],[153.32620320855614,61.604278074866365],[150.58823529411765,60.235294117647115],[149.2192513368984,58.86631016042786],[146.48128342245988,58.86631016042786],[143.74331550802137,57.49732620320861],[142.37433155080214,57.49732620320861],[141.00534759358288,57.49732620320861],[141.00534759358288,56.12834224598936],[141.00534759358288,56.12834224598936],null,[95.8288770053476,121.83957219251342],[95.8288770053476,121.83957219251342],[94.45989304812834,124.57754010695191],[90.35294117647058,130.0534759358289],[84.87700534759358,135.52941176470594],[80.77005347593582,142.3743315508022],[76.66310160427807,149.21925133689845],[73.92513368983957,154.69518716577545],[72.55614973262031,160.17112299465245],[69.81818181818181,164.27807486631022],[68.44919786096256,167.0160427807487],[68.44919786096256,168.38502673796796],[67.08021390374331,171.12299465240648],[65.71122994652406,173.86096256684496],[64.34224598930481,177.96791443850273],[62.97326203208556,182.07486631016047],[62.97326203208556,183.44385026737973],[61.60427807486631,186.18181818181822],[61.60427807486631,186.18181818181822],[61.60427807486631,186.18181818181822],[61.60427807486631,187.55080213903747],[61.60427807486631,188.91978609625673],[62.97326203208556,190.288770053476],[62.97326203208556,191.65775401069524],[62.97326203208556,193.02673796791447],[64.34224598930481,193.02673796791447],[64.34224598930481,193.02673796791447],[65.71122994652406,194.39572192513373],[67.08021390374331,194.39572192513373],[68.44919786096256,195.76470588235298],[69.81818181818181,195.76470588235298],[71.18716577540107,195.76470588235298],[71.18716577540107,195.76470588235298],[72.55614973262031,195.76470588235298],[73.92513368983957,195.76470588235298],[75.29411764705883,195.76470588235298],[75.29411764705883,195.76470588235298],[75.29411764705883,195.76470588235298],[76.66310160427807,195.76470588235298],[76.66310160427807,195.76470588235298],[76.66310160427807,195.76470588235298],[78.03208556149733,195.76470588235298],[79.40106951871657,195.76470588235298],[80.77005347593582,195.76470588235298],[80.77005347593582,195.76470588235298],[80.77005347593582,195.76470588235298],null],[[268.32085561497325,49.2834224598931],[268.32085561497325,49.2834224598931],[266.951871657754,49.2834224598931],[264.2139037433155,49.2834224598931],[261.47593582887697,49.2834224598931],[258.7379679144385,49.2834224598931],[257.36898395721926,49.2834224598931],[255.99999999999997,49.2834224598931],[254.63101604278074,50.65240641711235],[254.63101604278074,50.65240641711235],[254.63101604278074,50.65240641711235],[254.63101604278074,50.65240641711235],[254.63101604278074,49.2834224598931],[254.63101604278074,47.91443850267385],[253.2620320855615,46.5454545454546],[253.2620320855615,43.8074866310161],[251.89304812834223,42.43850267379685],[251.89304812834223,41.0695187165776],[251.89304812834223,41.0695187165776],[251.89304812834223,41.0695187165776],[250.52406417112297,41.0695187165776],[249.15508021390372,38.33155080213909],[247.7860962566845,34.224598930481335],[245.04812834224597,31.486631016042836],[242.31016042780746,28.748663101604333],[242.31016042780746,27.379679144385083],[240.94117647058823,27.379679144385083],[240.94117647058823,27.379679144385083],[240.94117647058823,27.379679144385083],[239.57219251336898,26.01069518716583],[238.20320855614972,26.01069518716583],[238.20320855614972,26.01069518716583],[236.83422459893046,26.01069518716583],[236.83422459893046,24.64171122994658],[235.4652406417112,24.64171122994658],[235.4652406417112,24.64171122994658],[234.09625668449198,24.64171122994658],[234.09625668449198,24.64171122994658],[232.72727272727272,24.64171122994658],[232.72727272727272,24.64171122994658],[229.9893048128342,24.64171122994658],[227.25133689839572,24.64171122994658],[224.5133689839572,24.64171122994658],[220.40641711229947,24.64171122994658],[219.0374331550802,24.64171122994658],[217.66844919786095,24.64171122994658],[216.2994652406417,24.64171122994658],[214.93048128342244,24.64171122994658],[213.5614973262032,24.64171122994658],[210.8235294117647,26.01069518716583],[209.45454545454544,26.01069518716583],[208.08556149732618,26.01069518716583],[206.71657754010695,26.01069518716583],[206.71657754010695,27.379679144385083],[205.3475935828877,27.379679144385083],[202.60962566844918,28.748663101604333],[199.87165775401067,31.486631016042836],[195.76470588235293,34.224598930481335],[193.0267379679144,35.59358288770059],[190.28877005347593,36.96256684491984],[188.91978609625667,38.33155080213909],[188.91978609625667,39.70053475935834],[188.91978609625667,39.70053475935834],[188.91978609625667,41.0695187165776],[187.55080213903742,41.0695187165776],[187.55080213903742,42.43850267379685],[186.18181818181816,43.8074866310161],[186.18181818181816,45.17647058823535],[186.18181818181816,45.17647058823535],[184.81283422459893,46.5454545454546],[184.81283422459893,46.5454545454546],[184.81283422459893,46.5454545454546],[184.81283422459893,47.91443850267385],[184.81283422459893,50.65240641711235],[183.44385026737967,52.0213903743316],[183.44385026737967,56.12834224598936],[182.07486631016042,57.49732620320861],[182.07486631016042,60.235294117647115],[182.07486631016042,61.604278074866365],[182.07486631016042,62.973262032085614],[182.07486631016042,67.08021390374337],[182.07486631016042,69.81818181818187],[182.07486631016042,73.92513368983963],[182.07486631016042,75.29411764705888],[182.07486631016042,78.03208556149738],[182.07486631016042,79.40106951871662],[182.07486631016042,79.40106951871662],[182.07486631016042,79.40106951871662],[182.07486631016042,79.40106951871662],[182.07486631016042,79.40106951871662],[180.70588235294116,79.40106951871662],[179.3368983957219,78.03208556149738],[175.22994652406416,75.29411764705888],[175.22994652406416,75.29411764705888],[173.8609625668449,75.29411764705888],[172.49197860962565,73.92513368983963],[171.12299465240642,73.92513368983963],[171.12299465240642,73.92513368983963],[169.75401069518716,73.92513368983963],[169.75401069518716,72.55614973262037],[168.3850267379679,72.55614973262037],[165.6470588235294,72.55614973262037],[162.9090909090909,71.18716577540113],[160.1711229946524,71.18716577540113],[157.4331550802139,69.81818181818187],[154.6951871657754,69.81818181818187],[151.95721925133688,69.81818181818187],[150.58823529411765,68.44919786096261],[149.2192513368984,68.44919786096261],[146.48128342245988,68.44919786096261],[145.11229946524062,68.44919786096261],[142.37433155080214,68.44919786096261],[141.00534759358288,68.44919786096261],[138.26737967914437,68.44919786096261],[135.52941176470588,68.44919786096261],[132.79144385026737,69.81818181818187],[131.4224598930481,69.81818181818187],[128.68449197860963,69.81818181818187],[127.31550802139037,71.18716577540113],[127.31550802139037,71.18716577540113],[127.31550802139037,71.18716577540113],[125.94652406417111,71.18716577540113],[125.94652406417111,71.18716577540113],[124.57754010695186,72.55614973262037],[123.20855614973262,72.55614973262037],[120.47058823529412,73.92513368983963],[117.7326203208556,75.29411764705888],[114.9946524064171,78.03208556149738],[113.62566844919786,79.40106951871662],[112.2566844919786,79.40106951871662],[110.88770053475935,80.77005347593588],[110.88770053475935,80.77005347593588],[109.5187165775401,82.13903743315514],[108.14973262032085,82.13903743315514],[105.41176470588235,83.50802139037438],[104.04278074866309,84.87700534759364],[101.30481283422459,87.61497326203214],[98.56684491978609,88.9839572192514],[95.8288770053476,91.7219251336899],[93.09090909090908,93.09090909090914],[91.72192513368984,94.4598930481284],[90.35294117647058,95.82887700534765],[88.98395721925134,98.56684491978615],[87.61497326203208,99.93582887700539],[84.87700534759358,102.6737967914439],[83.50802139037432,105.4117647058824],[82.13903743315508,106.78074866310166],[82.13903743315508,108.1497326203209],[82.13903743315508,109.51871657754016],[80.77005347593582,109.51871657754016],[80.77005347593582,109.51871657754016],[80.77005347593582,109.51871657754016],[80.77005347593582,110.8877005347594],[80.77005347593582,114.99465240641716],[79.40106951871657,119.10160427807492],[79.40106951871657,123.20855614973267],[78.03208556149733,127.31550802139043],[78.03208556149733,130.0534759358289],[78.03208556149733,131.42245989304817],[78.03208556149733,132.79144385026743],[78.03208556149733,132.79144385026743],[78.03208556149733,132.79144385026743],[78.03208556149733,132.79144385026743],[78.03208556149733,132.79144385026743],[78.03208556149733,132.79144385026743],[76.66310160427807,132.79144385026743],[76.66310160427807,132.79144385026743],[75.29411764705883,132.79144385026743],[73.92513368983957,132.79144385026743],[72.55614973262031,132.79144385026743],[71.18716577540107,132.79144385026743],[69.81818181818181,132.79144385026743],[69.81818181818181,132.79144385026743],[68.44919786096256,132.79144385026743],[67.08021390374331,132.79144385026743],[62.97326203208556,132.79144385026743],[58.8663101604278,132.79144385026743],[54.75935828877005,134.16042780748668],[52.021390374331546,134.16042780748668],[50.652406417112296,134.16042780748668],[49.283422459893046,134.16042780748668],[49.283422459893046,134.16042780748668],[49.283422459893046,134.16042780748668],[47.9144385026738,134.16042780748668],[47.9144385026738,134.16042780748668],[46.54545454545454,134.16042780748668],[46.54545454545454,134.16042780748668],[46.54545454545454,135.52941176470594],[46.54545454545454,135.52941176470594],[46.54545454545454,136.89839572192517],[47.9144385026738,138.26737967914443],[47.9144385026738,138.26737967914443],[49.283422459893046,141.00534759358294],[49.283422459893046,143.74331550802142],[50.652406417112296,146.48128342245994],[52.021390374331546,149.21925133689845],[53.3903743315508,150.5882352941177],[53.3903743315508,150.5882352941177],[54.75935828877005,151.95721925133694],[54.75935828877005,151.95721925133694],[56.1283422459893,153.3262032085562],[58.8663101604278,154.69518716577545],[60.23529411764706,154.69518716577545],[62.97326203208556,156.0641711229947],[64.34224598930481,157.43315508021396],[65.71122994652406,157.43315508021396],[68.44919786096256,158.8021390374332],[69.81818181818181,158.8021390374332],[72.55614973262031,158.8021390374332],[73.92513368983957,160.17112299465245],[76.66310160427807,160.17112299465245],[78.03208556149733,158.8021390374332],[78.03208556149733,158.8021390374332],[79.40106951871657,158.8021390374332],[79.40106951871657,158.8021390374332],[80.77005347593582,158.8021390374332],[80.77005347593582,158.8021390374332],[80.77005347593582,158.8021390374332],[80.77005347593582,158.8021390374332],[80.77005347593582,158.8021390374332],[82.13903743315508,161.5401069518717],[83.50802139037432,165.64705882352945],[84.87700534759358,169.75401069518722],[87.61497326203208,175.22994652406422],[88.98395721925134,177.96791443850273],[90.35294117647058,180.70588235294122],[91.72192513368984,182.07486631016047],[91.72192513368984,183.44385026737973],[93.09090909090908,183.44385026737973],[93.09090909090908,183.44385026737973],[94.45989304812834,184.812834224599],[97.19786096256684,186.18181818181822],[99.93582887700533,187.55080213903747],[104.04278074866309,188.91978609625673],[108.14973262032085,188.91978609625673],[112.2566844919786,190.288770053476],[117.7326203208556,191.65775401069524],[121.83957219251336,191.65775401069524],[127.31550802139037,193.02673796791447],[132.79144385026737,193.02673796791447],[139.63636363636363,194.39572192513373],[145.11229946524062,194.39572192513373],[151.95721925133688,194.39572192513373],[157.4331550802139,194.39572192513373],[162.9090909090909,194.39572192513373],[168.3850267379679,193.02673796791447],[173.8609625668449,191.65775401069524],[179.3368983957219,191.65775401069524],[183.44385026737967,190.288770053476],[187.55080213903742,188.91978609625673],[191.6577540106952,187.55080213903747],[195.76470588235293,186.18181818181822],[198.50267379679144,184.812834224599],[201.24064171122993,183.44385026737973],[203.97860962566844,182.07486631016047],[206.71657754010695,179.33689839572196],[209.45454545454544,177.96791443850273],[210.8235294117647,175.22994652406422],[213.5614973262032,172.4919786096257],[214.93048128342244,168.38502673796796],[217.66844919786095,164.27807486631022],[220.40641711229947,160.17112299465245],[223.14438502673795,157.43315508021396],[224.5133689839572,153.3262032085562],[224.5133689839572,151.95721925133694],[225.88235294117646,149.21925133689845],[227.25133689839572,145.11229946524068],[227.25133689839572,141.00534759358294],[227.25133689839572,138.26737967914443],[228.62032085561495,134.16042780748668],[228.62032085561495,131.42245989304817],[228.62032085561495,128.68449197860969],[228.62032085561495,124.57754010695191],[229.9893048128342,119.10160427807492],[229.9893048128342,114.99465240641716],[229.9893048128342,112.25668449197866],[229.9893048128342,109.51871657754016],[229.9893048128342,109.51871657754016],[231.35828877005346,109.51871657754016],[231.35828877005346,109.51871657754016],[231.35828877005346,109.51871657754016],[231.35828877005346,108.1497326203209],[231.35828877005346,108.1497326203209],[231.35828877005346,108.1497326203209],[232.72727272727272,108.1497326203209],[235.4652406417112,108.1497326203209],[236.83422459893046,108.1497326203209],[239.57219251336898,108.1497326203209],[240.94117647058823,108.1497326203209],[242.31016042780746,108.1497326203209],[243.67914438502672,108.1497326203209],[245.04812834224597,106.78074866310166],[246.41711229946523,105.4117647058824],[247.7860962566845,104.04278074866315],[249.15508021390372,102.6737967914439],[250.52406417112297,101.30481283422465],[251.89304812834223,99.93582887700539],[253.2620320855615,98.56684491978615],[254.63101604278074,97.19786096256689],[254.63101604278074,95.82887700534765],[255.99999999999997,94.4598930481284],[255.99999999999997,93.09090909090914],[257.36898395721926,93.09090909090914],[257.36898395721926,91.7219251336899],[257.36898395721926,91.7219251336899],[257.36898395721926,91.7219251336899],[257.36898395721926,90.35294117647064],[257.36898395721926,90.35294117647064],[257.36898395721926,90.35294117647064],[257.36898395721926,88.9839572192514],[257.36898395721926,87.61497326203214],[258.7379679144385,84.87700534759364],[258.7379679144385,80.77005347593588],[258.7379679144385,79.40106951871662],[260.1069518716577,78.03208556149738],[260.1069518716577,76.66310160427813],[260.1069518716577,76.66310160427813],[260.1069518716577,75.29411764705888],[260.1069518716577,75.29411764705888],[260.1069518716577,75.29411764705888],[260.1069518716577,75.29411764705888],[260.1069518716577,73.92513368983963],[260.1069518716577,72.55614973262037],[260.1069518716577,68.44919786096261],[262.8449197860962,62.973262032085614],[264.2139037433155,58.86631016042786],[265.58288770053474,56.12834224598936],[265.58288770053474,54.75935828877011],[266.951871657754,53.39037433155086],[266.951871657754,52.0213903743316],[266.951871657754,52.0213903743316],[266.951871657754,52.0213903743316],[268.32085561497325,50.65240641711235],[268.32085561497325,50.65240641711235],[268.32085561497325,49.2834224598931],[269.6898395721925,49.2834224598931],[269.6898395721925,49.2834224598931],[269.6898395721925,47.91443850267385],[269.6898395721925,49.2834224598931],null,[223.14438502673795,53.39037433155086],null,[167.01604278074865,120.47058823529417],[167.01604278074865,120.47058823529417],[167.01604278074865,120.47058823529417],[167.01604278074865,123.20855614973267],[165.6470588235294,124.57754010695191],[165.6470588235294,125.94652406417117],[164.27807486631016,127.31550802139043],[162.9090909090909,128.68449197860969],[161.54010695187165,130.0534759358289],[161.54010695187165,131.42245989304817],[160.1711229946524,131.42245989304817],[160.1711229946524,132.79144385026743],[160.1711229946524,132.79144385026743],[158.80213903743314,132.79144385026743],[157.4331550802139,134.16042780748668],[157.4331550802139,135.52941176470594],[156.06417112299465,136.89839572192517],[154.6951871657754,136.89839572192517],[153.32620320855614,138.26737967914443],[153.32620320855614,138.26737967914443],[153.32620320855614,138.26737967914443],[151.95721925133688,138.26737967914443],[151.95721925133688,139.63636363636368],[150.58823529411765,139.63636363636368],[149.2192513368984,139.63636363636368],[147.85026737967914,139.63636363636368],[146.48128342245988,141.00534759358294],[146.48128342245988,141.00534759358294],[145.11229946524062,141.00534759358294],[143.74331550802137,141.00534759358294],[141.00534759358288,141.00534759358294],[138.26737967914437,141.00534759358294],[136.8983957219251,141.00534759358294],[135.52941176470588,141.00534759358294],[134.16042780748663,141.00534759358294],[134.16042780748663,141.00534759358294],[132.79144385026737,141.00534759358294],[131.4224598930481,141.00534759358294],[130.05347593582886,141.00534759358294],[128.68449197860963,141.00534759358294],[128.68449197860963,141.00534759358294],[127.31550802139037,141.00534759358294],[125.94652406417111,141.00534759358294],[125.94652406417111,141.00534759358294],[124.57754010695186,141.00534759358294],[124.57754010695186,141.00534759358294],[124.57754010695186,141.00534759358294],[124.57754010695186,141.00534759358294],[124.57754010695186,141.00534759358294],[124.57754010695186,139.63636363636368],[124.57754010695186,139.63636363636368],[123.20855614973262,139.63636363636368],[123.20855614973262,139.63636363636368],[123.20855614973262,139.63636363636368],[123.20855614973262,139.63636363636368],null]],R=[0,0,0,230,101,88,73,102,77,77,0,42,0,0,0,8,0,2,135,105,0,4,0,0,0,1,0,0,0,42,136,37,0,4,0,0,0,1,0,0,0,80,0,0,0,0,0,3,160,1,0,3,0,0,0,1,0,1,0,0,160,2,0,4,0,0,0,1,0,0,4,0,160,3,0,4,0,0,0,1,0,0,4,0,0,0,0,0,0,5,0,0,0,1,0,0,0,4,2,2,0,0,0,1,0,2,0,0,0,2,78,0,0,0,0,2,0,5,0,0,0,3,0,0,0,170,0,3,0,2,0,0,0,2,69,0,0,0,0,4,0,5,0,0,0,3,0,0,0,194,0,5,0,1,0,0,0,1,0,0,0,0,0,6,0,5,0,0,0,1,0,0,0,218,0,0,0,0,0,0,0,35,0,0,0,1,0,0,0,40,0,0,0,1,0,3,221,10,0,0,39,16,0,0,0,139,0,0,0,1,0,0,0,45,0,0,0,1,0,0,17,112,0,0,0,100,0,0,0,2,0,0,0,1,0,0,0,0,45,100,66,140];function E(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function T(e,t,n){return t&&E(e.prototype,t),n&&E(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var O=T((function e(t){var n=t.x,r=t.y,i=t.radius,o=t.vx,a=void 0===o?0:o,s=t.vy,u=void 0===s?0:s,c=t.spreadX,l=void 0===c?0:c,f=t.spreadY,h=void 0===f?0:f,d=t.parent,p=void 0===d?null:d;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.x=n,this.y=r,this.radius=i,this.vx=a,this.vy=u,this.spreadX=l,this.spreadY=h,this.nextSpawn=0,this.lastSpawn=0,this.parent=p,this.isNew=!0,this.isKilled=!1,this.shrink=0}));function C(e){return function(e){if(Array.isArray(e))return D(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return D(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?D(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function D(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function M(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function F(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var B=function(){function e(t){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;M(this,e),this.context=t,this.program=null,this.vertexFunc="",this.fragmentFunc="",this.vertexAttributes=[],this.instanceAttributes=[],this.uniformAttributes=[],this.vertexData=[],this.indexData=[],this.instanceData=[],this.usesFrameBuffer=!1,this.frameBuffer=null,this.frameTexture=null,this.usesInstance=!1,this.instanceBuffer=null,this.instanceCount=0,this.totalInstanceComponents=0,this.clearColor=[0,0,0,0],this.textures=[],this.blendSrc=t.SRC_ALPHA,this.blendDst=t.ONE_MINUS_SRC_ALPHA,this.width=0,this.height=0,this.readyResolve=null,this.readyPromise=new Promise((function(e){n.readyResolve=e})),this.initialize(r)}var t,n;return t=e,n=[{key:"initialize",value:function(e){this.initializeData(e),this.createProgram(),this.createBuffers(),this.usesFrameBuffer&&this.createFrameBuffer(),this.initializeAttributes(),this.createTextures(),this.bindBuffers()}},{key:"initializeData",value:function(e){}},{key:"createProgram",value:function(){var e=this.context,t=e.createShader(e.VERTEX_SHADER);if(e.shaderSource(t,this.vertexFunc),e.compileShader(t),e.getShaderParameter(t,e.COMPILE_STATUS)){var n=e.createShader(e.FRAGMENT_SHADER);if(e.shaderSource(n,this.fragmentFunc),e.compileShader(n),e.getShaderParameter(n,e.COMPILE_STATUS)){var r=e.createProgram();if(e.attachShader(r,t),e.attachShader(r,n),e.linkProgram(r),e.getProgramParameter(r,e.LINK_STATUS))this.program=r;else{var i=e.getProgramInfoLog(r);s("Failed to link program: ",i)}}else{var o=e.getShaderInfoLog(n);s("Failed to compile fragment shader: ",o)}}else{var a=e.getShaderInfoLog(t);s("Failed to compile vertex shader: ",a)}}},{key:"createBuffers",value:function(){var e=this.context;this.vertexArrayObj=e.createVertexArray(),e.bindVertexArray(this.vertexArrayObj),this.arrayBuffer=e.createBuffer(),this.indexBuffer=e.createBuffer(),this.usesInstance=this.instanceAttributes.length>0,this.usesInstance&&(this.instanceBuffer=e.createBuffer()),e.bindVertexArray(null)}},{key:"bindBuffers",value:function(){var e=this.context;e.bindVertexArray(this.vertexArrayObj),e.bindBuffer(e.ARRAY_BUFFER,this.arrayBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.vertexData),e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Int16Array(this.indexData),e.STATIC_DRAW),this.usesInstance&&(e.bindBuffer(e.ARRAY_BUFFER,this.instanceBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.instanceData),e.DYNAMIC_DRAW)),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindVertexArray(null)}},{key:"createFrameBuffer",value:function(){var e=this.context;this.frameBuffer=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffer),this.frameTexture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.frameTexture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,0,0,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.frameTexture,0),e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null)}},{key:"initializeAttributes",value:function(){var e=this.context;e.bindVertexArray(this.vertexArrayObj),this.generateVertexData(),this.generateInstanceData(),e.bindVertexArray(null),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.enable(e.BLEND)}},{key:"createTextures",value:function(){var e=this,t=this.context;t.useProgram(this.program);var n=[];this.textureObjects=[],this.textures.forEach((function(r,i){if("string"==typeof r.src){var o=new Image,a=t.createTexture(),s=new Promise((function(t){o.onload=function(){e.setTexture(i,r.name,a,o),t()},o.src=r.src}));n.push(s)}else e.setTexture(i,r.name,r.src)})),t.activeTexture(t["TEXTURE".concat(this.textures.length+1)]),t.activeTexture(t["TEXTURE".concat(this.textures.length)]),Promise.all(n).then((function(){e.readyResolve()}))}},{key:"setTexture",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=this.context;a.useProgram(this.program),a.bindTexture(a.TEXTURE_2D,n),r instanceof Image?a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,r):a.texImage2D(a.TEXTURE_2D,0,a.RGBA,i,o,0,a.RGBA,a.UNSIGNED_BYTE,null),a.generateMipmap(a.TEXTURE_2D),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.bindTexture(a.TEXTURE_2D,null);var s=a.getUniformLocation(this.program,t);a.uniform1i(s,e),a.activeTexture(a["TEXTURE".concat(e)]),this.textureObjects[e]=n}},{key:"generateVertexData",value:function(){for(var e=this,t=this.context,n=[],r=this.vertexAttributes[0].initialValue.length/this.vertexAttributes[0].numComponents,i=function(t){e.vertexAttributes.forEach((function(e){var r=e.numComponents*t;n.push.apply(n,C(e.initialValue.slice(r,r+e.numComponents)))}))},o=0;o<r;o+=1)i(o);this.vertexData=n;var a=0;this.vertexAttributes.forEach((function(e){a+=4*e.numComponents})),t.bindBuffer(t.ARRAY_BUFFER,this.arrayBuffer);var s=0;this.vertexAttributes.forEach((function(n){var r=t.getAttribLocation(e.program,n.name);t.enableVertexAttribArray(r),t.vertexAttribPointer(r,n.numComponents,n.type,n.normalize,a,s),s+=4*n.numComponents})),t.bindBuffer(t.ARRAY_BUFFER,null)}},{key:"generateInstanceData",value:function(){var e=this;if(this.usesInstance){var t=this.context,n=[],r=this.instanceAttributes[0].initialValue.length;this.instanceCount=r/this.instanceAttributes[0].numComponents;for(var i=function(t){e.instanceAttributes.forEach((function(e){var r=e.numComponents*t;n.push.apply(n,C(e.initialValue.slice(r,r+e.numComponents)))}))},o=0;o<this.instanceCount;o+=1)i(o);this.instanceData=n;var a=0,s=0;this.instanceAttributes.forEach((function(e){a+=4*e.numComponents,s+=e.numComponents})),this.totalInstanceComponents=s,t.bindBuffer(t.ARRAY_BUFFER,this.instanceBuffer);var u=0;this.instanceAttributes.forEach((function(n){var r=t.getAttribLocation(e.program,n.name);t.enableVertexAttribArray(r),t.vertexAttribPointer(r,n.numComponents,n.type,n.normalize,a,u),u+=4*n.numComponents,t.vertexAttribDivisor(r,1)})),t.bindBuffer(t.ARRAY_BUFFER,null)}}},{key:"setInstanceData",value:function(e){var t=this.context;this.instanceData=e,t.bindVertexArray(this.vertexArrayObj),t.bindBuffer(t.ARRAY_BUFFER,this.instanceBuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array(e),t.DYNAMIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindVertexArray(null),this.instanceCount=Math.floor(e.length/this.totalInstanceComponents)}},{key:"resize",value:function(e,t){this.width=e,this.height=t,this.resizeFrameBuffer(e,t)}},{key:"resizeFrameBuffer",value:function(e,t){if(this.usesFrameBuffer){var n=this.context;n.useProgram(this.program),n.bindTexture(n.TEXTURE_2D,this.frameTexture),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,e,t,0,n.RGBA,n.UNSIGNED_BYTE,null),n.bindTexture(n.TEXTURE_2D,null)}}},{key:"draw",value:function(){var e=this.context;e.viewport(0,0,this.width,this.height),e.useProgram(this.program),e.bindVertexArray(this.vertexArrayObj),this.blendSrc&&this.blendDst?(e.enable(e.BLEND),e.blendFunc(this.blendSrc,this.blendDst)):e.disable(e.BLEND),this.usesFrameBuffer&&e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffer),this.clearColor&&(e.clearColor(this.clearColor[0],this.clearColor[1],this.clearColor[2],this.clearColor[3]),e.clear(e.COLOR_BUFFER_BIT)),this.textureObjects.forEach((function(t,n){e.activeTexture(e["TEXTURE".concat(n)]),e.bindTexture(e.TEXTURE_2D,t)}));var t=this.indexData.length;this.usesInstance?e.drawElementsInstanced(e.TRIANGLES,t,e.UNSIGNED_SHORT,0,this.instanceCount):e.drawElements(e.TRIANGLES,t,e.UNSIGNED_SHORT,0),this.usesFrameBuffer&&e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindVertexArray(null)}},{key:"setUniform",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=this.context,i=r.getUniformLocation(this.program,e);if(r.useProgram(this.program),n)switch(t.length){case 1:r.uniform1fv(i,t);break;case 2:r.uniform2fv(i,t);break;case 3:r.uniform3fv(i,t);break;case 4:r.uniform4fv(i,t);break;default:s("Unsupported uniform data length: ",t.length)}else switch(t.length){case 1:r.uniform1iv(i,t);break;case 2:r.uniform2iv(i,t);break;case 3:r.uniform3iv(i,t);break;case 4:r.uniform4iv(i,t);break;default:s("Unsupported uniform data length: ",t.length)}}},{key:"setUniformMatrix",value:function(e,t){var n=this.context,r=n.getUniformLocation(this.program,e);n.useProgram(this.program),n.uniformMatrix3fv(r,!1,t)}},{key:"clearCanvas",value:function(e,t,n,r){var i=this.context;this.usesFrameBuffer&&i.bindFramebuffer(i.FRAMEBUFFER,this.frameBuffer),i.clearColor(e,t,n,r),i.clear(i.COLOR_BUFFER_BIT),this.usesFrameBuffer&&i.bindFramebuffer(i.FRAMEBUFFER,null)}}],n&&F(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function k(e){return k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},k(e)}function _(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function I(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function j(){return j="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=U(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},j.apply(this,arguments)}function U(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=W(e)););return e}function L(e,t){return L=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},L(e,t)}function z(e,t){if(t&&("object"===k(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function W(e){return W=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},W(e)}var N=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&L(e,t)}(a,e);var t,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=W(r);if(i){var n=W(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return z(this,e)});function a(){return _(this,a),o.apply(this,arguments)}return t=a,(n=[{key:"initializeData",value:function(e){var t=e.buffer,n=this.context;this.vertexFunc="#version 300 es\nuniform vec2 screenScale;\n\nin vec2 position;\nout vec2 vTexCoord;\n\nvoid main() {\n  vTexCoord = vec2((position.x + 1.0) * 0.5, (1.0 - position.y) * 0.5);\n  vec2 pos = position * screenScale;\n  gl_Position = vec4(pos, 0.0, 1.0);\n}\n",this.fragmentFunc="#version 300 es\nprecision highp float;\n\nuniform sampler2D sampler;\n\nin vec2 vTexCoord;\n\nout vec4 outColor;\n\nvoid main() {\n  outColor = texture(sampler, vTexCoord);\n}\n",this.vertexAttributes=[{name:"position",numComponents:2,type:n.FLOAT,normalize:!1,dynamic:!1,initialValue:[-1,-1,1,-1,-1,1,1,1]}],this.uniformAttributes=[{name:"screenScale"}],this.indexData=[0,1,2,2,1,3],this.textures=[{name:"sampler",src:t}],this.clearColor=[1,1,1,1]}},{key:"resize",value:function(e,t){j(W(a.prototype),"resize",this).call(this,e,t);var n=1,r=1;e>t?r=e/t:n=t/e,this.setUniform("screenScale",[n,r])}}])&&I(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(B);function V(e){return V="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},V(e)}function X(e){return function(e){if(Array.isArray(e))return Y(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return Y(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Y(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function G(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function H(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function q(){return q="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=K(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},q.apply(this,arguments)}function K(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Q(e)););return e}function $(e,t){return $=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},$(e,t)}function J(e,t){if(t&&("object"===V(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function Q(e){return Q=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Q(e)}var Z=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&$(e,t)}(a,e);var t,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Q(r);if(i){var n=Q(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return J(this,e)});function a(){return G(this,a),o.apply(this,arguments)}return t=a,n=[{key:"initializeData",value:function(){this.vertexFunc="#version 300 es\nuniform vec2 screenScale;\nuniform mat3 bones[8];\n\nin vec2 position;\nin vec2 boneIndices;\nin vec2 boneWeights;\nin vec2 texCoord;\nout vec2 vTexCoord;\n\nvoid main() {\n  vTexCoord = texCoord;\n  vec3 pos = vec3(position, 1.0);\n  vec3 wPos = bones[int(boneIndices[0])] * pos * boneWeights[0]\n              + bones[int(boneIndices[1])] * pos * boneWeights[1];\n  gl_Position = vec4(wPos.xy * screenScale / wPos.z, 0.0, 1.0);\n}\n",this.fragmentFunc="#version 300 es\nprecision highp float;\n\nuniform sampler2D sampler;\n\nin vec2 vTexCoord;\n\nout vec4 outColor;\n\nvoid main() {\n  outColor = texture(sampler, vTexCoord);\n}\n",this.updateVertexAttributes(),this.uniformAttributes=[{name:"screenScale"},{name:"bones"}],this.indexData=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23,24,25,26,24,26,27,28,29,30,28,30,31],this.textures=[{name:"sampler",src:"./img/character.png"}],this.usesFrameBuffer=!0,this.clearColor=null}},{key:"updateVertexAttributes",value:function(){var e=this.context;this.vertexAttributes=[{name:"position",numComponents:2,type:e.FLOAT,normalize:!1,dynamic:!1,initialValue:[].concat(X(S.getVertexPosition("hair2",!0,!0,!1)),X(S.getVertexPosition("upperArm",!0,!0,!1)),X(S.getVertexPosition("body",!1,!0,!0)),X(S.getVertexPosition("head",!1,!0,!0)),X(S.getVertexPosition("mouth",!1,!0,!0)),X(S.getVertexPosition("hair1",!0,!0,!1)),X(S.getVertexPosition("lowerArm",!1,!0,!0)),X(S.getVertexPosition("hand",!1,!0,!0)))},{name:"texCoord",numComponents:2,type:e.FLOAT,normalize:!1,dynamic:!1,initialValue:[].concat(X(S.getTexcoord("hair2",!0,!0)),X(S.getTexcoord("upperArm",!0,!0)),X(S.getTexcoord("body",!0,!0)),X(S.getTexcoord("head",!0,!0)),X(S.getTexcoord("mouth",!0,!0)),X(S.getTexcoord("hair1",!0,!0)),X(S.getTexcoord("lowerArm",!0,!0)),X(S.getTexcoord("hand",!0,!0)))},{name:"boneIndices",numComponents:2,type:e.FLOAT,normalize:!1,dynamic:!1,initialValue:[7,7,7,7,7,7,7,7,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3]},{name:"boneWeights",numComponents:2,type:e.FLOAT,normalize:!1,dynamic:!1,initialValue:[1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0]}]}},{key:"setMode",value:function(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=this.context;S.hand.texcoord=S.hand.texcoords[e],S.mouth.texcoord=S.mouth.texcoords[r],i.bindVertexArray(this.vertexArrayObj),(t=this.vertexAttributes[1].initialValue).splice.apply(t,[32,8].concat(X(S.getTexcoord("mouth",!0,!0)))),(n=this.vertexAttributes[1].initialValue).splice.apply(n,[56,8].concat(X(S.getTexcoord("hand",!0,!0)))),this.generateVertexData(),i.bindBuffer(i.ARRAY_BUFFER,this.arrayBuffer),i.bufferData(i.ARRAY_BUFFER,new Float32Array(this.vertexData),i.STATIC_DRAW),i.bindBuffer(i.ARRAY_BUFFER,null),i.bindVertexArray(null)}},{key:"setRandomPose",value:function(){var e=[[0,0,105,95],[0,1,105,95],[0,3,105,95],[1,1,300,250],[1,1,300,250],[1,3,300,250],[2,1,135,0],[2,2,135,0],[2,2,135,0],[3,1,460,126],[3,1,460,126],[3,3,460,126]],t=e[Math.floor(Math.random()*e.length)];return this.setMode(t[0],t[1]),[t[2],t[3]]}},{key:"resize",value:function(){var e=1024;q(Q(a.prototype),"resize",this).call(this,e,e);var t=2/e;this.setUniform("screenScale",[t,t])}}],n&&H(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(B);function ee(e){return ee="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ee(e)}function te(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ne(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function re(){return re="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=ie(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},re.apply(this,arguments)}function ie(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=se(e)););return e}function oe(e,t){return oe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},oe(e,t)}function ae(e,t){if(t&&("object"===ee(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function se(e){return se=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},se(e)}var ue=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&oe(e,t)}(a,e);var t,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=se(r);if(i){var n=se(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return ae(this,e)});function a(){return te(this,a),o.apply(this,arguments)}return t=a,(n=[{key:"initializeData",value:function(){var e=this.context;this.vertexFunc="#version 300 es\nuniform vec2 screenScale;\nuniform float size;\n\nin vec2 position;\nin vec2 centerPos;\n\nout vec2 vTexCoord;\n\nvoid main() {\n  vTexCoord = (position + vec2(1.0)) * 0.5;\n  vec2 cPos = centerPos * screenScale - vec2(1.0);\n  vec2 vPos = cPos + position * size * screenScale;\n  gl_Position = vec4(vPos, 0.0, 1.0);\n}\n",this.fragmentFunc="#version 300 es\nprecision highp float;\n\nuniform sampler2D sampler;\n\nin vec2 vTexCoord;\n\nout vec4 outColor;\n\nvoid main() {\n  vec4 brush = texture(sampler, vTexCoord);\n  outColor = vec4(0.0, 0.0, 0.0, brush.a);\n}\n",this.vertexAttributes=[{name:"position",numComponents:2,type:e.FLOAT,normalize:!1,dynamic:!1,initialValue:[-1,-1,1,-1,-1,1,1,1]}],this.instanceAttributes=[{name:"centerPos",numComponents:2,type:e.FLOAT,normalize:!1,dynamic:!0,initialValue:[500,500]}],this.uniformAttributes=[{name:"screenScale"},{name:"size"}],this.indexData=[0,1,2,2,1,3],this.textures=[{name:"sampler",src:"./img/brush.png"}],this.usesFrameBuffer=!0,this.clearColor=null,this.blendSrc=e.SRC_ALPHA,this.blendDst=e.ONE}},{key:"resize",value:function(){var e=1024;re(se(a.prototype),"resize",this).call(this,e,e);var t=2/e;this.setUniform("screenScale",[t,t])}},{key:"resizeFrameBuffer",value:function(e,t){this.isFrameInitialized||(re(se(a.prototype),"resizeFrameBuffer",this).call(this,e,t),this.isFrameInitialized=!0)}}])&&ne(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(B);function ce(e){return ce="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ce(e)}function le(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function fe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function he(){return he="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=de(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},he.apply(this,arguments)}function de(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ve(e)););return e}function pe(e,t){return pe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},pe(e,t)}function me(e,t){if(t&&("object"===ce(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function ve(e){return ve=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},ve(e)}var ye=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&pe(e,t)}(a,e);var t,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ve(r);if(i){var n=ve(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return me(this,e)});function a(){return le(this,a),o.apply(this,arguments)}return t=a,(n=[{key:"initializeData",value:function(){var e=this.context;this.vertexFunc="#version 300 es\nuniform vec2 screenScale;\n\nin vec2 position;\nin vec2 centerPos;\nin float radius;\nin float thickness;\nin vec2 spread;\n\nout vec2 vTexCoord;\nout float vThickness;\n\nvoid main() {\n  vTexCoord = (position + vec2(1.0)) * 0.5;\n  vThickness = thickness;\n  vec2 cPos = centerPos * screenScale - vec2(1.0);\n  vec2 vPos = cPos + position * radius * (spread + vec2(1.0)) * vec2(1.0, 1.5) * screenScale;\n  gl_Position = vec4(vPos, 0.0, 1.0);\n}\n",this.fragmentFunc="#version 300 es\nprecision highp float;\n\nuniform sampler2D sampler;\n\nin vec2 vTexCoord;\nin float vThickness;\n\nout vec4 outColor;\n\nvoid main() {\n  outColor = texture(sampler, vTexCoord);\n  outColor.b = vThickness;\n}\n",this.vertexAttributes=[{name:"position",numComponents:2,type:e.FLOAT,normalize:!1,dynamic:!1,initialValue:[-1,-1,1,-1,-1,1,1,1]}],this.instanceAttributes=[{name:"centerPos",numComponents:2,type:e.FLOAT,normalize:!1,dynamic:!0,initialValue:[-.7,-.7,0,0,.5,.5]},{name:"radius",numComponents:1,type:e.FLOAT,normalize:!1,dynamic:!0,initialValue:[1,1,1]},{name:"thickness",numComponents:1,type:e.FLOAT,normalize:!1,dynamic:!0,initialValue:[1,1,1]},{name:"spread",numComponents:2,type:e.FLOAT,normalize:!1,dynamic:!0,initialValue:[0,0,0,.5,0,.5]}],this.uniformAttributes=[{name:"screenScale"}],this.indexData=[0,1,2,2,1,3],this.textures=[{name:"sampler",src:"./img/drop-color-alpha.png"}],this.usesFrameBuffer=!0,this.clearColor=[0,0,0,0]}},{key:"resize",value:function(){var e=1024;he(ve(a.prototype),"resize",this).call(this,e,e);var t=2/e;this.setUniform("screenScale",[t,t])}}])&&fe(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(B);function ge(e){return ge="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ge(e)}function be(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function we(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function xe(){return xe="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=Pe(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},xe.apply(this,arguments)}function Pe(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Re(e)););return e}function Se(e,t){return Se=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Se(e,t)}function Ae(e,t){if(t&&("object"===ge(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function Re(e){return Re=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Re(e)}var Ee=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Se(e,t)}(a,e);var t,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Re(r);if(i){var n=Re(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Ae(this,e)});function a(){return be(this,a),o.apply(this,arguments)}return t=a,(n=[{key:"initializeData",value:function(e){var t=e.src,n=e.buffer,r=this.context;this.vertexFunc="#version 300 es\nin vec2 position;\nout vec2 vTexCoord;\n\nvoid main() {\n  vTexCoord = vec2((position.x + 1.0) * 0.5, (position.y + 1.0) * 0.5);\n  gl_Position = vec4(position, 0.0, 1.0);\n}\n",this.fragmentFunc="#version 300 es\nprecision highp float;\n\nuniform sampler2D sampler;\n\nin vec2 vTexCoord;\n\nout vec4 outColor;\n\nvoid main() {\n  outColor = texture(sampler, vTexCoord);\n}\n",this.vertexAttributes=[{name:"position",numComponents:2,type:r.FLOAT,normalize:!1,dynamic:!1,initialValue:[-1,-1,1,-1,-1,1,1,1]}],this.uniformAttributes=[],this.indexData=[0,1,2,2,1,3],this.textures=[{name:"sampler",src:t}],this.usesFrameBuffer=!!n,this.frameBuffer=n,this.clearColor=[1,1,1,1]}},{key:"createFrameBuffer",value:function(){}},{key:"resizeFrameBuffer",value:function(){}},{key:"resize",value:function(){xe(Re(a.prototype),"resize",this).call(this,1024,1024)}}])&&we(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(B);function Te(e){return Te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Te(e)}function Oe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ce(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function De(){return De="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=Me(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},De.apply(this,arguments)}function Me(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ke(e)););return e}function Fe(e,t){return Fe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Fe(e,t)}function Be(e,t){if(t&&("object"===Te(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function ke(e){return ke=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},ke(e)}var _e=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Fe(e,t)}(a,e);var t,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ke(r);if(i){var n=ke(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Be(this,e)});function a(){return Oe(this,a),o.apply(this,arguments)}return t=a,(n=[{key:"initializeData",value:function(e){var t=e.backgroundSampler,n=e.frostSampler,r=this.context;this.vertexFunc="#version 300 es\nin vec2 position;\nout vec2 vTexCoord;\n\nvoid main() {\n  vTexCoord = vec2((position.x + 1.0) * 0.5, (1.0 - position.y) * 0.5);\n  vec2 pos = position;\n  gl_Position = vec4(pos, 0.0, 1.0);\n}\n",this.fragmentFunc="#version 300 es\nprecision highp float;\n\nuniform sampler2D frostSampler;\nuniform sampler2D backgroundSampler;\n\nuniform vec2 parallax;\nuniform float parallaxFg;\nuniform float textureRatio;\nuniform float frostAlpha;\nuniform float frostAdd;\n\nin vec2 vTexCoord;\n\nout vec4 outColor;\n\nvec4 blend(vec4 bg, vec4 fg) {\n  vec3 bgm = bg.rgb * bg.a;\n  vec3 fgm = fg.rgb * fg.a;\n  float ia = 1.0 - fg.a;\n  float a = (fg.a + bg.a * ia);\n  vec3 rgb;\n  if (a != 0.0) {\n    rgb = (fgm + bgm * ia) / a;\n  } else {\n    rgb = vec3(0.0, 0.0, 0.0);\n  }\n  return vec4(rgb, a);\n}\n\nvec2 calcParallax(float v) {\n  return parallax * v;\n}\n\nvec2 texCoord() {\n  return vec2(vTexCoord.x, vTexCoord.y);\n}\n\nvec2 scaledTexCoord() {\n  vec2 scale = vec2(1.0);\n  vec2 offset = vec2(0.0);\n  float ratioDelta = 1.0 - textureRatio;\n  if (ratioDelta >= 0.0) {\n    scale.y = (1.0 + ratioDelta);\n    offset.y = ratioDelta / 2.0;\n  } else {\n    scale.x = (1.0 - ratioDelta);\n    offset.x = -ratioDelta / 2.0;\n  }\n  return (texCoord() + offset) / scale;\n}\n\nvoid main() {\n  vec2 bgCoord = scaledTexCoord() + calcParallax(parallaxFg);\n  vec4 frost = texture(frostSampler, vTexCoord);\n  float alpha = (1.0 - frost.a * (1.0 - frostAdd));\n  vec4 frostColor = vec4(1.0, 1.0, 1.0, alpha * frostAlpha);\n  vec4 bg = texture(backgroundSampler, bgCoord);\n\n  /*\n  if (alpha > 0.0) {\n    vec4 bg2 = vec4(0.0);\n    float diff = 0.02;\n    bg2 += texture(backgroundSampler, bgCoord + vec2(diff, diff)) * 0.05;\n    bg2 += texture(backgroundSampler, bgCoord + vec2(diff, 0)) * 0.2;\n    bg2 += texture(backgroundSampler, bgCoord + vec2(diff, -diff)) * 0.05;\n    bg2 += texture(backgroundSampler, bgCoord + vec2(0, diff)) * 0.2;\n    // bg2 += texture(backgroundSampler, bgCoord + vec2(0, 0));\n    bg2 += texture(backgroundSampler, bgCoord + vec2(0, -diff)) * 0.2;\n    bg2 += texture(backgroundSampler, bgCoord + vec2(-diff, diff)) * 0.05;\n    bg2 += texture(backgroundSampler, bgCoord + vec2(-diff, 0)) * 0.2;\n    bg2 += texture(backgroundSampler, bgCoord + vec2(-diff -diff)) * 0.05;\n    // bg2 /= 9.0;\n    bg2.a = alpha;\n    bg = blend(bg, bg2);\n    outColor = blend(bg, frostColor);\n  } else {\n    outColor = bg;\n  }\n  */\n  outColor = blend(bg, frostColor);\n}\n",this.vertexAttributes=[{name:"position",numComponents:2,type:r.FLOAT,normalize:!1,dynamic:!1,initialValue:[-1,-1,1,-1,-1,1,1,1]}],this.uniformAttributes=[{name:"parallax"},{name:"parallaxFg"},{name:"textureRatio"},{name:"frostAlpha"},{name:"frostAdd"}],this.indexData=[0,1,2,2,1,3],this.textures=[{name:"frostSampler",src:n},{name:"backgroundSampler",src:t}],this.usesFrameBuffer=!0,this.clearColor=null}},{key:"resize",value:function(e,t){De(ke(a.prototype),"resize",this).call(this,e,t)}}])&&Ce(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(B);function Ie(e){return Ie="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ie(e)}function je(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ue(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Le(){return Le="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=ze(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},Le.apply(this,arguments)}function ze(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Ve(e)););return e}function We(e,t){return We=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},We(e,t)}function Ne(e,t){if(t&&("object"===Ie(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function Ve(e){return Ve=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Ve(e)}var Xe=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&We(e,t)}(a,e);var t,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Ve(r);if(i){var n=Ve(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Ne(this,e)});function a(){return je(this,a),o.apply(this,arguments)}return t=a,(n=[{key:"initializeData",value:function(e){var t=e.backgroundSampler,n=e.rainSampler,r=this.context;this.vertexFunc="#version 300 es\nuniform vec2 screenScale;\nuniform vec2 offset;\n\nin vec2 position;\nout vec2 vTexCoord;\n\nvoid main() {\n  vTexCoord = vec2((position.x + 1.0) * 0.5, (1.0 - position.y) * 0.5);\n  vec2 pos = (position - offset) * screenScale;\n  gl_Position = vec4(pos, 0.0, 1.0);\n}\n",this.fragmentFunc='#version 300 es\nprecision highp float;\n\nuniform sampler2D rainSampler;\nuniform sampler2D shadowSampler;\nuniform sampler2D backgroundSampler;\n\nuniform vec2 resolution;\nuniform vec2 parallax;\nuniform float parallaxFg;\nuniform float parallaxBg;\nuniform float textureRatio;\nuniform float minRefraction;\nuniform float refractionDelta;\nuniform float brightness;\nuniform float alphaMultiply;\nuniform float alphaSubtract;\n\nin vec2 vTexCoord;\n\nout vec4 outColor;\n\nvec4 blend(vec4 bg, vec4 fg) {\n  vec3 bgm = bg.rgb * bg.a;\n  vec3 fgm = fg.rgb * fg.a;\n  float ia = 1.0 - fg.a;\n  float a = (fg.a + bg.a * ia);\n  vec3 rgb;\n  if (a != 0.0) {\n    rgb = (fgm + bgm * ia) / a;\n  } else {\n    rgb = vec3(0.0, 0.0, 0.0);\n  }\n  return vec4(rgb, a);\n}\n\nvec2 calcParallax(float v) {\n  return parallax / resolution * v;\n}\n\nvec2 texCoord() {\n  return vec2(vTexCoord.x, resolution.y - vTexCoord.y) / resolution;\n}\n\nvec2 scaledTexCoord() {\n  float ratio = resolution.x / resolution.y;\n  vec2 scale = vec2(1.0);\n  vec2 offset = vec2(0.0);\n  float ratioDelta = ratio - textureRatio;\n  if (ratioDelta >= 0.0) {\n    scale.y = (1.0 + ratioDelta);\n    offset.y = ratioDelta / 2.0;\n  } else {\n    scale.x = (1.0 - ratioDelta);\n    offset.x = -ratioDelta / 2.0;\n  }\n  return (texCoord() + offset) / scale;\n}\n\nvoid main() {\n  vec4 rainColor = texture(rainSampler, vTexCoord);\n\n  vec2 bgCoord = scaledTexCoord() + calcParallax(parallaxFg);\n  vec4 bg = texture(backgroundSampler, scaledTexCoord() + calcParallax(parallaxFg));\n\n  float d = rainColor.b; // "thickness"\n  float x = rainColor.g;\n  float y = rainColor.r;\n\n  float a = clamp(rainColor.a * alphaMultiply - alphaSubtract, 0.0, 1.0);\n\n  vec2 refraction = (vec2(x, y) - 0.5) * 2.0;\n  vec2 refractionParallax = calcParallax(parallaxBg - parallaxFg);\n  vec2 refractionPos = scaledTexCoord()\n    + (refraction / resolution * (minRefraction + d * refractionDelta))\n    + refractionParallax;\n\n  vec4 tex = texture(backgroundSampler, refractionPos);\n  vec4 shadowColor = texture(shadowSampler, vec2(x, y - 0.1));\n  // shadowColor.a *= rainColor.a;\n\n  vec4 fg = vec4(tex.rgb * brightness * (1.0 - shadowColor.a), a);\n\n  outColor = blend(bg, fg);\n  outColor.a = 1.0;\n}\n',this.vertexAttributes=[{name:"position",numComponents:2,type:r.FLOAT,normalize:!1,dynamic:!1,initialValue:[-1,-1,1,-1,-1,1,1,1]}],this.uniformAttributes=[{name:"screenScale"},{name:"offset"},{name:"resolution"},{name:"parallax"},{name:"parallaxFg"},{name:"parallaxBg"},{name:"textureRatio"},{name:"minRefraction"},{name:"refractionDelta"},{name:"brightness"},{name:"alphaMultiply"},{name:"alphaSubtract"}],this.indexData=[0,1,2,2,1,3],this.textures=[{name:"rainSampler",src:n},{name:"shadowSampler",src:"./img/shadow.png"},{name:"backgroundSampler",src:t}],this.usesFrameBuffer=!0,this.clearColor=[0,0,0,1]}},{key:"resize",value:function(e,t){Le(Ve(a.prototype),"resize",this).call(this,e,t);var n=1,r=1;e>t?r=e/t:n=t/e,this.setUniform("screenScale",[n,r]),this.setUniform("resolution",[1,1])}}])&&Ue(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(B);function Ye(e){return function(e){if(Array.isArray(e))return Ge(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return Ge(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ge(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ge(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function He(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var qe=function(e){for(var t=[0,0],n=0;n<e.length;n+=1){var r=e[n];t[0]+=r.clientX,t[1]+=r.clientY}return[t[0]/e.length,t[1]/e.length]},Ke=function(){function n(e,t){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this.isPlaying=!1,this.isResetting=!1,this.screenshotResolve=null,this.drawingLogs=[],this.isAutoPlaying=!1,this.autoPlayTime=6e4,this.autoPlayIndex=0,this.autoPlayOffsetX=0,this.autoPlayOffsetY=0,this.autoPlayData=null,this.watchdog=null,this.cleanAreas=[[!0,!0,!0,!0],[!0,!0,!0,!0],[!0,!0,!0,!0],[!0,!0,!0,!0]],this.fingerPos=[53,169],this.canvas=document.createElement("canvas"),this.canvas.tabIndex=1,this.canvas.style.width=e||"100%",this.canvas.style.height=t||"100%",this.canvas.style.objectFit="contain",this.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)};try{this.context=this.canvas.getContext("webgl2",{alpha:!0,depth:!0,stencil:!0,antialias:!0,premultipliedAlpha:!1,preserveDrawingBuffer:!1,preferLowPowerToHighPerformance:!1,failIfMajorPerformanceCaveat:!1})}catch(e){throw s("Failed to create WebGL2 context",e),e}this.characterShader=new Z(this.context),this.drawingShader=new ue(this.context),this.bufferShader=new N(this.context,{buffer:this.drawingShader.frameTexture}),this.rainShader=new ye(this.context),this.imageShader=new Ee(this.context,{src:"./img/background.png",buffer:this.characterShader.frameBuffer}),this.innerWindowShader=new _e(this.context,{backgroundSampler:this.characterShader.frameTexture,frostSampler:this.drawingShader.frameTexture}),this.outerWindowShader=new Xe(this.context,{backgroundSampler:this.innerWindowShader.frameTexture,rainSampler:this.rainShader.frameTexture}),this.readyPromise=new Promise((function(e){var t=[r.characterShader,r.drawingShader,r.bufferShader,r.rainShader,r.imageShader,r.innerWindowShader,r.outerWindowShader].map((function(e){return e.readyPromise}));Promise.all(t).then(e)})),this.drops=[],this.drawingPoints=[],this.previousPoint=null,this.previousTouch=null,this.isRaining=!0,this.minR=20,this.maxR=50,this.maxDrops=900,this.rainChance=.35,this.rainLimit=6,this.dropletsRate=50,this.dropletsSize=[3,5.5],this.trailRate=1,this.trailScaleRange=[.2,.45],this.collisionRadius=.45,this.dropletsCleaningRadiusMultiplier=.28,this.flashChance=0,this.collisionRadiusIncrease=2e-4,this.collisionBoostMultiplier=.05,this.collisionBoost=1,this.dropFallMultiplier=1,this.autoShrink=!0,this.globalTimeScale=1,this.lastRender=null,this.areaMultiplier=1,this.timeScale=1,this.spawnArea=[-.1,.95],this.width=0,this.height=0,this.scale=window.devicePixelRatio,this.xPosScale=1,this.yPosScale=1,this.xPosOffset=0,this.yPosOffset=0,this.xPosUserOffset=0,this.yPosUserOffset=0,this.xMaxOffset=0,this.yMaxOffset=0,this.body=new g,this.body.position=S.getPosition("root","body"),this.upperArm=new g,this.upperArm.parent=this.body,this.upperArm.position=S.getPosition("body","upperArm",!0),this.lowerArm=new g,this.lowerArm.parent=this.upperArm,this.lowerArm.position=S.getPosition("upperArm","lowerArm"),this.hand=new g,this.hand.parent=this.lowerArm,this.hand.position=S.getPosition("lowerArm","hand",!0),this.head=new g,this.head.parent=this.body,this.head.position=S.getPosition("body","head",!0),this.mouth=new g,this.mouth.parent=this.head,this.mouth.position=S.getPosition("head","mouth",!0),this.hair=new g,this.hair.parent=this.head,this.hair.position=S.getPosition("head","hair1",!0),this.hair2=new g,this.hair2.parent=this.head,this.hair2.position=S.getPosition("head","hair2",!0),this.bones=[this.body,this.upperArm,this.lowerArm,this.hand,this.head,this.mouth,this.hair,this.hair2],this.isDrawing=!1,this.isDragging=!1,this.canvas.addEventListener("mousedown",(function(e){e.preventDefault(),r.stopWatchdog(),r.isDrawing=!0,r.addDrawingPoint(e)})),this.canvas.addEventListener("touchstart",(function(e){e.preventDefault(),r.stopWatchdog();var t=e.targetTouches;if(t.length>=2)r.dragPoint=qe(t);else if(r.isDrawing=!0,!r.previousTouch&&1===t.length){var n=t[0];r.addDrawingPoint(n),r.previousTouch=n}})),this.canvas.addEventListener("mousemove",(function(e){var t=r.convertPosition(e);if(r.fingerPos=t,r.isDragging){var n=t[0]-r.previousPoint[0],i=t[1]-r.previousPoint[1];r.moveOffset(n,i),r.previousPoint=t}else r.isDrawing?r.addDrawingPoint(e):r.resetWatchdog()})),this.canvas.addEventListener("touchmove",(function(e){e.preventDefault(),r.resetWatchdog();var t=e.targetTouches;if(t.length>=2&&r.dragPoint){var n=qe(t);return r.moveOffset(-(n[0]-r.dragPoint[0])*window.devicePixelRatio,(n[1]-r.dragPoint[1])*window.devicePixelRatio),r.dragPoint=n,void r.updateOffset()}for(var i=null,o=0;o<t.length;o+=1){var a;t[o].identifier===(null===(a=r.previousTouch)||void 0===a?void 0:a.identifier)&&(i=t[o])}if(i){var s=r.convertPosition(i);if(r.fingerPos=s,r.isDragging){var u=s[0]-r.previousPoint[0],c=s[1]-r.previousPoint[1];return r.moveOffset(u,c),void(r.previousPoint=s)}r.isDrawing&&r.addDrawingPoint(i)}else r.resetWatchdog()})),document.addEventListener("mouseup",(function(){r.isDrawing=!1,r.previousPoint=null,r.dragPoint=null,r.addNullToDrawingLogs(),r.resetWatchdog()})),document.addEventListener("touchend",(function(e){for(var t=e.changedTouches,n=0;n<t.length;n+=1){var i;t[n].identifier===(null===(i=r.previousTouch)||void 0===i?void 0:i.identifier)&&(r.isDrawing=!1,r.previousPoint=null,r.previousTouch=null,r.addNullToDrawingLogs())}r.resetWatchdog()})),document.addEventListener("mousewheel",(function(e){r.yMaxOffset>0?r.moveOffset(0,e.wheelDelta):r.xMaxOffset>0&&r.moveOffset(e.wheelDelta,0),r.updateOffset()})),this.innerWindowShader.setUniform("parallax",[0,0]),this.innerWindowShader.setUniform("parallaxFg",[20]),this.innerWindowShader.setUniform("textureRatio",[1]),this.innerWindowShader.setUniform("frostAlpha",[.8]),this.innerWindowShader.setUniform("frostAdd",[0]),this.outerWindowShader.setUniform("offset",[0,0]),this.outerWindowShader.setUniform("parallax",[0,0]),this.outerWindowShader.setUniform("parallaxFg",[20]),this.outerWindowShader.setUniform("parallaxBg",[5]),this.outerWindowShader.setUniform("textureRatio",[1]),this.outerWindowShader.setUniform("minRefraction",[.25]),this.outerWindowShader.setUniform("refractionDelta",[.25]),this.outerWindowShader.setUniform("brightness",[1.04]),this.outerWindowShader.setUniform("alphaMultiply",[6]),this.outerWindowShader.setUniform("alphaSubtract",[3]),this.drawingShader.clearCanvas(1,1,1,0),this.drawingShader.setUniform("size",[10])}var r,o;return r=n,o=[{key:"convertPosition",value:function(e){return[e.clientX*this.xPosScale+this.xPosOffset+this.xPosUserOffset/2,e.clientY*this.yPosScale+this.yPosOffset-this.yPosUserOffset/2]}},{key:"addNullToDrawingLogs",value:function(){this.drawingLogs.length<=0||null!==this.drawingLogs[this.drawingLogs.length-1]&&this.drawingLogs.push(null)}},{key:"addDrawingPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=t?e:this.convertPosition(e);this.fingerPos=n,this.drawingLogs.push(n);var r,i=Math.max(0,Math.min(3,Math.floor(n[0]/256))),o=Math.max(0,Math.min(3,Math.floor(n[1]/256)));if(this.cleanAreas[i][o]=!1,this.previousPoint)for(var a=n[0]-this.previousPoint[0],s=n[1]-this.previousPoint[1],u=Math.sqrt(a*a+s*s),c=Math.ceil(u),l=a/c,f=s/c,h=this.previousPoint[0],d=this.previousPoint[1],p=0;p<c;p+=1)h+=l,d+=f,this.drawingPoints.push(h,d);else(r=this.drawingPoints).push.apply(r,Ye(n));this.previousPoint=n}},{key:"moveOffset",value:function(e,t){var n=this.xPosOffset+this.xPosUserOffset+e,r=this.yPosOffset+this.yPosUserOffset+t,i=Math.max(-this.xMaxOffset,Math.min(this.xMaxOffset,n)),o=Math.max(this.yScreenOffset,Math.min(this.yMaxOffset-this.yScreenOffset,r));this.xPosUserOffset=i-this.xPosOffset,this.yPosUserOffset=o-this.yPosOffset}},{key:"resizeCanvas",value:function(e,t){var n=e||this.canvas.clientWidth,r=t||this.canvas.clientHeight;this.scale=window.devicePixelRatio,this.width=n,this.height=r,this.scaledWidth=n*this.scale,this.scaledHeight=r*this.scale,this.windowSize=1024,this.areaMultiplier=this.windowSize/1024,this.canvas.width=this.scaledWidth,this.canvas.height=this.scaledHeight;var i=this.windowSize/n,o=this.windowSize/r;i>o?(this.xPosScale=o,this.yPosScale=o,this.xPosOffset=this.windowSize-o*n,this.yPosOffset=0,this.yScreenOffset=0):(this.xPosScale=i,this.yPosScale=i,this.xPosOffset=0,this.yPosOffset=(this.windowSize-i*r)/2,this.yScreenOffset=-this.yPosOffset),this.xMaxOffset=this.xPosOffset,this.yMaxOffset=2*this.yPosOffset,this.moveOffset(0,0),this.screenSizeChanged=!0}},{key:"updateScreenScale",value:function(){this.characterShader.resize(this.scaledWidth,this.scaledHeight),this.drawingShader.resize(this.scaledWidth,this.scaledHeight),this.bufferShader.resize(this.scaledWidth,this.scaledHeight),this.rainShader.resize(this.scaledWidth,this.scaledHeight),this.imageShader.resize(this.scaledWidth,this.scaledHeight),this.innerWindowShader.resize(this.scaledWidth,this.scaledHeight),this.outerWindowShader.resize(this.scaledWidth,this.scaledHeight),this.updateOffset()}},{key:"updateOffset",value:function(){this.outerWindowShader.setUniform("offset",[(this.xPosOffset+this.xPosUserOffset)/this.windowSize,(this.yPosOffset+this.yPosUserOffset+this.yScreenOffset)/this.windowSize])}},{key:"appendTo",value:function(e){var t=this;e.appendChild(this.canvas),this.resizeCanvas(),"undefined"!=typeof window&&window.addEventListener("resize",(function(){t.resizeCanvas()})),setTimeout((function(){return t.resizeCanvas()}),1)}},{key:"requestNextFrame",value:function(){var e=this;this.requestAnimationFrame.call(window,(function(){if(e.isAutoPlaying){var t=e.autoPlayData[e.autoPlayIndex];if(t){var n=t[0]+e.autoPlayOffsetX,r=t[1]+e.autoPlayOffsetY;e.addDrawingPoint([n,r],!0)}else e.previousPoint=null,e.addNullToDrawingLogs();e.autoPlayIndex+=1,e.autoPlayIndex>=e.autoPlayData.length&&e.resetWatchdog()}if(e.screenshotResolve){e.outerWindowShader.setUniform("offset",[0,0]);var i=e.fingerPos;e.fingerPos=e.characterShader.setRandomPose(),e.update(!0),e.generateScreenshot(),e.characterShader.setMode(0,0),e.fingerPos=i,e.updateOffset()}else e.update(!1),e.outerWindowShader.usesFrameBuffer=!1,e.draw(!1);e.isPlaying&&e.requestNextFrame()}))}},{key:"resetDrawing",value:function(){var e=this;this.isResetting||(this.isResetting=!0,this.characterShader.setMode(0,2),i(1,0,(function(t){e.innerWindowShader.setUniform("frostAdd",[t/1])}),(function(){e.drawingShader.clearCanvas(1,1,1,0),e.innerWindowShader.setUniform("frostAdd",[0]),e.characterShader.setMode(0,0),e.isResetting=!1;for(var t=0;t<4;t+=1)for(var n=0;n<4;n+=1)e.cleanAreas[t][n]=!0;e.drawingLogs=[]})))}},{key:"generateScreenshot",value:function(){var e=this.context,t=this.windowSize,n=this.windowSize;this.outerWindowShader.usesFrameBuffer=!0,this.outerWindowShader.resize(t,n),this.draw(!0);var r=new Uint8Array(t*n*4);e.bindFramebuffer(e.FRAMEBUFFER,this.outerWindowShader.frameBuffer),e.readPixels(0,0,t,n,e.RGBA,e.UNSIGNED_BYTE,r),e.bindFramebuffer(e.FRAMEBUFFER,null);var i=document.createElement("canvas");i.width=t,i.height=n;var o=i.getContext("2d"),a=o.createImageData(t,n);a.data.set(r),o.putImageData(a,0,0);var s=document.createElement("canvas");s.width=t,s.height=n;var u=s.getContext("2d");u.scale(1,-1),u.drawImage(i,0,-n);var c=this.screenshotResolve;s.toBlob((function(e){var t=new FileReader;t.onload=function(e){for(var t=e.target.result,n=new Uint8Array(t,0,t.length),r=new DataView(n.buffer),i=8,o=[],a=[],s=null;i<n.length;){var u=i,l=r.getUint32(i,!1),f="";i+=4;for(var h=0;h<4;h+=1)f+=String.fromCharCode(n[i+h]);if(i+=4,"IHDR"===f)s=i+l+4;else{if("eXIf"===f){o=n.slice(0,u),a=n.slice(i+l+4,n.length);break}if("IEND"===f){o=n.slice(0,s),a=n.slice(s,n.length);break}}i+=l+4}var d=new Blob([o.buffer,new Uint8Array(R).buffer,a.buffer],{type:"image/png"}),p=new FileReader;p.onload=function(e){var t=new Image;t.src=e.target.result,c(t)},p.readAsDataURL(d)},t.readAsArrayBuffer(e)}),"image/png"),this.screenshotResolve=null,this.outerWindowShader.resize(this.scaledWidth,this.scaledHeight),this.outerWindowShader.usesFrameBuffer=!1}},{key:"generateDrawingURL",value:function(){for(var e=this.drawingLogs.length,t=0,n=e-1;n>=0&&(null===this.drawingLogs[n]?t+=1:t+=3,!(t>=1350));n-=1);var r=n>=0;n=Math.max(0,n);for(var i="".concat(window.location.origin+window.location.pathname,"?d="),o=n;o<e;o+=1)if(null===this.drawingLogs[o])o<e-1&&(i+=",");else{var a=Math.max(0,Math.min(511,Math.round(.5*this.drawingLogs[o][0]))),s=Math.max(0,Math.min(511,Math.round(.5*this.drawingLogs[o][1]))),u=(7&a)<<3|(448&s)>>6,c=63&s;i+=h((504&a)>>3)+h(u)+h(c)}return[i,r]}},{key:"loadDrawingURL",value:function(){var e=new URLSearchParams(window.location.search).get("d");if(e&&!(e.length<=0)){this.previousPoint=null;for(var t=0;t<e.length;)if(","===e[t])this.previousPoint=null,this.addNullToDrawingLogs(),t+=1;else{var n=d(e[t]),r=d(e[t+1]),i=n<<3|r>>>3&7,o=(7&r)<<6|63&d(e[t+2]);this.addDrawingPoint([2*i,2*o],!0),t+=3}this.previousPoint=null,this.addNullToDrawingLogs()}}},{key:"update",value:function(n){var r=this,i=Date.now();null===this.lastRender&&(this.lastRender=i);var o=i-this.lastRender,a=Math.max(1.1,60*o*.001);this.timeScale=a*this.globalTimeScale,this.lastRender=i,this.updateCharacter(n),this.updateDrawing(),this.updateRain(),this.drops.sort((function(e,t){var n=e.y*r.windowSize+e.x;return t.y*r.windowSize+t.x-n}));var s=.1/(this.maxR-this.minR)*this.timeScale;this.drops.forEach((function(n,i){if(!n.isKilled){if(t((n.radius-r.minR*r.dropFallMultiplier)*s)&&(n.vy+=e(0,n.radius/r.maxR*4)),r.autoShrink&&n.radius<=r.minR&&t(.05*r.timeScale)&&(n.shrink+=.01),n.radius-=n.shrink*r.timeScale,n.radius<=0&&(n.isKilled=!0),r.isRaining&&(n.lastSpawn+=n.vy*r.timeScale*r.trailRate,!(r.drops.length>=r.maxDrops*r.areaMultiplier)&&n.lastSpawn>n.nextSpawn)){var o=new O({x:n.x+.1*e(-n.radius,n.radius),y:n.y-.01*n.radius,radius:n.radius*e.apply(void 0,Ye(r.trailScaleRange)),spreadY:.1*n.vy,parent:n});r.drops.push(o),n.radius*=Math.pow(.97,r.timeScale),n.lastSpawn=0,n.nextSpawn=e(r.minR,r.maxR)-2*n.vy*r.trailRate+r.maxR-n.radius}n.spreadX*=Math.pow(.4,r.timeScale),n.spreadY*=Math.pow(.7,r.timeScale);var a=n.vy>0;a&&!n.isKilled&&(n.y+=n.vy*r.globalTimeScale,n.x+=n.vx*r.globalTimeScale,n.y>r.windowSize+n.radius&&(n.isKilled=!0));var u=(a||n.isNew)&&!n.isKilled;n.isNew=!1,u&&r.drops.slice(i+1,i+70).forEach((function(e){if(n!==e&&n.radius>e.radius&&n.parent!==e&&e.parent!==n&&!e.isKilled){var t=e.x-n.x,i=e.y-n.y;if(Math.sqrt(t*t+i*i)<(n.radius+e.radius)*(r.collisionRadius+n.vy*r.collisionRadiusIncrease*r.timeScale)){var o=n.radius*n.radius,a=e.radius*e.radius,s=Math.min(r.maxR,Math.sqrt(o+.8*a));n.radius=s,n.vx+=.1*t,n.spreadX=0,n.spreadY=0,e.isKilled=!0,n.vy=Math.max(e.vy,Math.min(40,n.vy+s*r.collisionBoostMultiplier+r.collisionBoost))}}})),n.vy-=.1*Math.max(1,.5*r.minR-n.vy)*r.timeScale,n.vy=Math.max(0,n.vy),n.vx*=Math.pow(.7,r.timeScale)}})),this.drops=this.drops.filter((function(e){return!e.isKilled}));var u=[];this.drops.forEach((function(e){var t=Math.max(0,Math.min(1,(e.radius-r.minR)/r.deltaR*.9));t*=1/(.5*(e.spreadX+e.spreadY)+1),u.push(e.x,e.y,e.radius,t,e.spreadX,e.spreadY)})),this.rainShader.setInstanceData(u),this.screenSizeChanged&&(this.updateScreenScale(),this.screenSizeChanged=!1)}},{key:"updateCharacter",value:function(){this.body.rotation=Math.PI,this.upperArm.rotation=-Math.PI,this.lowerArm.rotation=Math.PI,this.hand.rotation=-Math.PI,this.hair.rotation=-Math.PI,this.hair2.rotation=170*-Math.PI/180,this.head.rotation=-10/180*Math.PI,this.mouth.rotation=0;var e=this.fingerPos,t=5e-4*Date.now(),n=Math.sin(t);this.hair.rotation=-Math.PI-3*(n+1)/180*Math.PI,this.hair2.rotation=172*-Math.PI/180-3*(n+1)/180*Math.PI,this.head.rotation=4*(n-1)/180*Math.PI;var r=Math.atan2(e[0],this.windowSize+e[1])-Math.PI,i=Math.atan2(e[0],1.5*this.windowSize-e[1])-Math.PI,o=Math.sqrt(166257),a=7/180*Math.PI;this.hand.parent=null,this.hand.rotation=-i;var s=[e[0]-o*Math.sin(this.hand.rotation+a)-.5*this.windowSize,e[1]-o*Math.cos(this.hand.rotation+a)-.5*this.windowSize];this.hand.position=s,this.upperArm.rotation=r,this.upperArm.update(),this.lowerArm.update();var u=this.lowerArm.getWorldPosition(),c=Math.sqrt(217556),l=[s[0]+20-u[0],s[1]-u[1]],f=Math.sqrt(l[0]*l[0]+l[1]*l[1]),h=l[0]/f*60,d=Math.atan2(l[0],l[1])-Math.PI,p=Math.max(.3,(f+h)/c);this.lowerArm.rotation=d-r,this.lowerArm.scale=[1,p],this.bones.forEach((function(e){e.update()}));var m=[];this.bones.forEach((function(e){m.push.apply(m,Ye(e.worldMatrix))})),this.characterShader.setUniformMatrix("bones",m)}},{key:"updateRain",value:function(){if(this.isRaining)for(var n=this.rainLimit*this.timeScale*this.areaMultiplier,r=this.maxDrops*this.areaMultiplier,i=0;t(this.rainChance*this.timeScale*this.areaMultiplier)&&i<n&&this.drops.length<r;){i+=1;var o=e(this.minR,this.maxR,(function(e){return Math.pow(e,3)})),a=new O({x:e(0,this.windowSize),y:e(this.windowSize*this.spawnArea[0],this.windowSize*this.spawnArea[1]),radius:o,vy:1+.1*(o-this.minR)+e(0,2),spreadX:1.5,spreadY:1.5});this.drops.push(a)}}},{key:"updateDrawing",value:function(){this.drawingShader.setInstanceData(this.drawingPoints),this.drawingPoints=[]}},{key:"draw",value:function(){var e=this.context;this.imageShader.draw(),this.characterShader.draw(),this.drawingShader.draw(),this.rainShader.draw(),this.innerWindowShader.draw(),this.outerWindowShader.draw(),e.flush()}},{key:"play",value:function(){this.isPlaying||(this.isPlaying=!0,this.resetWatchdog(),this.requestNextFrame())}},{key:"pause",value:function(){this.isPlaying=!1}},{key:"screenshot",value:function(){var e=this;return new Promise((function(t){e.screenshotResolve=t}))}},{key:"setAutoPlayOffset",value:function(){for(var e=Math.floor(4*Math.random()),t=Math.floor(4*Math.random()),n=0;n<4;n+=1)for(var r=0;r<4;r+=1){var i=(n+e)%4,o=(r+t)%4;if(this.cleanAreas[i][o])return this.autoPlayOffsetX=256*i,this.autoPlayOffsetY=256*o,!0}return!1}},{key:"autoPlay",value:function(){if(this.setAutoPlayOffset()){clearTimeout(this.watchdog),this.autoPlayIndex=0;var e=A.length,t=Math.floor(Math.random()*e);this.autoPlayData=A[t],this.isAutoPlaying=!0,this.characterShader.setMode(0,1)}}},{key:"resetWatchdog",value:function(){this.stopWatchdog(),this.startWatchdog()}},{key:"startWatchdog",value:function(){var e=this;this.watchdog=setTimeout((function(){return e.autoPlay()}),this.autoPlayTime)}},{key:"stopWatchdog",value:function(){clearTimeout(this.watchdog),this.isAutoPlaying&&(this.characterShader.setMode(0,0),this.previousPoint=null),this.isAutoPlaying=!1}}],o&&He(r.prototype,o),Object.defineProperty(r,"prototype",{writable:!1}),n}();function $e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Je=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.itemsElement=document.getElementById("menu-items"),this.buttonElement=document.getElementById("menu-toggle-button"),this.iconElement=document.getElementById("menu-toggle-icon"),this.buttons=t,this.isOpen=!1,this.delay=.05,t.forEach((function(e){return e.appendTo(n.itemsElement)}));var r=90/(t.length-1);t.forEach((function(e,t){var n=r*t+270;e.container.style.transform="rotate(-".concat(n,"deg)"),e.iconElement.style.transform="rotate(".concat(n,"deg)")})),this.buttonElement.addEventListener("touchstart",(function(e){return n.handleClick(e)})),this.buttonElement.addEventListener("mousedown",(function(e){return n.handleClick(e)}))}var t,n;return t=e,(n=[{key:"handleClick",value:function(e){var t=this;e.preventDefault();var n=.2;this.isOpen?(this.isOpen=!1,this.buttons.forEach((function(e,n){return e.close(n*t.delay)})),i(n,0,(function(e){var r=-45*(1-e/n);t.iconElement.style.transform="rotate(".concat(r,"deg)")}))):(this.isOpen=!0,this.buttons.forEach((function(e,n){return e.open(n*t.delay)})),i(n,0,(function(e){var r=-45*e/n;t.iconElement.style.transform="rotate(".concat(r,"deg)")})))}}])&&$e(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Qe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ze(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var et=function(){function e(t){var n=this,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];Qe(this,e),this.isPlaying=!1,this.isStarted=!1,this.isReady=!1,this.context=new AudioContext,this.source=this.context.createBufferSource();var i=new XMLHttpRequest;i.open("GET",t,!0),i.responseType="arraybuffer",i.onload=function(){n.context.decodeAudioData(i.response,(function(e){n.source.buffer=e,n.source.loop=r,n.source.loopStart=.5,n.source.loopEnd=e.duration-.5}),(function(){}))},i.send()}var t,n;return t=e,(n=[{key:"play",value:function(){this.isPlaying||(this.isStarted?this.context.resume():(this.source.connect(this.context.destination),this.source.start(0),this.isStarted=!0),this.isPlaying=!0)}},{key:"pause",value:function(){this.isPlaying&&(this.context.suspend(),this.isPlaying=!1)}}])&&Ze(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function tt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}document.addEventListener("DOMContentLoaded",(function(){window.addEventListener("touchmove",(function(e){e.preventDefault()})),window.addEventListener("touchstart",(function(e){e.preventDefault()}));var e=document.getElementById("root"),t=new Ke;t.readyPromise.then((function(){t.loadDrawingURL()})),t.appendTo(e),t.play();var n=new et("./rain.mp3"),r=new m("sound","volume-xmark",(function(){n.isPlaying?(r.setIcon("volume-xmark"),n.pause()):(r.setIcon("volume-high"),n.play())})),s=new m("reset","wind",(function(){t.resetDrawing()})),u=new m("screenshot","camera",(function(){var n=document.getElementById("flash");n.style.opacity=1,n.style.visibility="visible",i(.5,0,(function(e){n.style.opacity=1-e/.5}),(function(){n.style.visibility="hidden"})),t.screenshot().then((function(t){i(.5,0,(function(t){var n=Math.floor(t/.5*5);e.style.filter="blur(".concat(n,"px)")})),t.className="ss-image",t.id="ss",t.alt="photo.png",document.getElementById("ss").replaceWith(t),document.getElementById("ss-wrapper").style.visibility="visible"}))})),c=function(){i(.5,0,(function(t){var n=5-Math.floor(t/.5*5);e.style.filter="blur(".concat(n,"px)")})),document.getElementById("ss-wrapper").style.visibility="hidden"};o("ss-wrapper",c),a("ss-frame"),o("ss-close",c);var l=new m("save","arrow-up-from-bracket",(function(){i(.5,0,(function(t){var n=Math.floor(t/.5*5);e.style.filter="blur(".concat(n,"px)")}));var n,r,o=(n=t.generateDrawingURL(),r=2,function(e){if(Array.isArray(e))return e}(n)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);a=!0);}catch(e){s=!0,i=e}finally{try{a||null==n.return||n.return()}finally{if(s)throw i}}return o}}(n,r)||function(e,t){if(e){if("string"==typeof e)return tt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?tt(e,t):void 0}}(n,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),a=o[0],s=o[1],u=document.getElementById("save-wrapper");document.getElementById("save-url").value=a,document.getElementById("save-warning-text").style.display=s?"block":"none",document.getElementById("copied-message-wrapper").style.visibility="hidden",document.getElementById("save-url-twitter-link").href="https://twitter.com/share?text=%E2%98%94&url=".concat(a),navigator.share||(document.getElementById("save-url-share").style.display="none"),u.style.visibility="visible"})),f=function(){i(.5,0,(function(t){var n=5-Math.floor(t/.5*5);e.style.filter="blur(".concat(n,"px)")})),document.getElementById("save-wrapper").style.visibility="hidden"};o("copy-url-button",(function(){var e=document.getElementById("save-url"),t=function(){var e=document.getElementById("copied-message-wrapper");e.style.opacity=0,e.style.visibility="visible";var t=.1;i(t,0,(function(n){e.style.opacity=n/t}),(function(){i(t,1,(function(n){e.style.opacity=1-n/t}),(function(){e.style.visibility="hidden"}))}))};if(navigator.clipboard&&"function"==typeof navigator.clipboard.writeText)navigator.clipboard.writeText(e.value).then(t,(function(){}));else{e.contentEditable=!0,e.readOnly=!1;var n=document.createRange();n.selectNodeContents(e);var r=window.getSelection();r.removeAllRanges(),r.addRange(n),e.setSelectionRange(0,1e5),document.execCommand("copy"),e.contentEditable=!1,e.readOnly=!0,window.getSelection().removeAllRanges(),t()}})),o("save-url-share",(function(){if(navigator.share){var e=document.getElementById("save-url");navigator.share({title:"",text:"",url:e.value})}})),o("save-wrapper",f),a("save-frame"),o("save-close",f);var h=document.getElementById("description"),d=new m("help","question",(function(){h.scrollTop=0,h.scrollLeft=0,h.style.visibility="visible",i(.5,0,(function(t){var n=Math.floor(t/.5*5);e.style.filter="blur(".concat(n,"px)")})),i(.5,0,(function(e){h.style.opacity=e/.5}))})),p=function(){i(.5,0,(function(t){var n=5-Math.floor(t/.5*5);e.style.filter="blur(".concat(n,"px)")})),i(.5,0,(function(e){h.style.opacity=1-e/.5}),(function(){h.style.visibility="hidden"}))};o("description-close",p),a("description-outer-wrapper"),o("description",p),new Je([r,s,u,l,d])}))}();